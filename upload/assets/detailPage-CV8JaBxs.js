import{w as f}from "./with-props-JNWkkrjn.js";import{a as d,p,s as b,w as y}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as e}from "./jsx-runtime-D_zvdyIk.js";import{A as w}from "./auDetailHeaderComponent-B_2kTVIv.js";import{L as j}from "./loadingComponent-BmsJ8g5Y.js";import{I as v}from "./inquiry-AmjiLZEt.js";import{I as N}from "./ImageModalComponent-Cw5E8d8F.js";import{c as k,d as I,e as D}from "./useInquiryMutation-D96ppYmq.js";import{m as C,n as q,o as A}from "./inquiriesAPI-gt-yzMzF.js";import{u as S}from "./useQuery-CxabGwVz.js";import"./index-Druiat5n.js";import"./proxy-B6a-3iLd.js";import"./QueryClientProvider--V26__jT.js";import"./useMutation-iBKtBQ4J.js";import"./mutation-CruqbX-z.js";import"./removable-CGh8wCEh.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./useBaseQuery-BTSvK_Q6.js";import"./query-CjmfnAM3.js";function E({data:t}){var u;if(!t)return null;const n=((u=v.find(a=>a.value===t.type))==null?void 0:u.label)??t.type,s=[{label:"문의 ID",value:t.inquiryId},{label:"유형",value:n},{label:"등록일",value:new Date(t.regDate).toLocaleString()}];t.modDate!==t.regDate&&s.push({label:"수정일",value:new Date(t.modDate).toLocaleString()}),t.isDelete&&s.push({value:e.jsx("span",{className:"text-red-500 font-semibold",children:"삭제됨"})});const r=t.status==="ANSWERED",l=r?"답변 완료":"대기 중",o=r?"bg-green-200 text-green-800":"bg-gray-200 text-gray-700";return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 my-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-6 text-sm text-gray-600",children:s.map((a, m)=>e.jsxs("div",{className:"flex items-center",children:[a.label&&e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-white mr-1 whitespace-nowrap",children:[a.label,":"]}),e.jsx("span",{className:"break-all",children:a.value})]},m))}),e.jsx("div",{className:`px-4 py-1 rounded-full text-sm font-semibold shadow-sm ${o}`,children:l})]})})}const R="https://myapp.peek-pick.click",L=({data:t})=>{const[n,s]=d.useState(null);return t?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-lg font-bold text-gray-700 dark:text-white",children:"문의 내용"})}),e.jsx("div",{className:"prose prose-sm prose-gray mt-2 max-w-none whitespace-pre-wrap",children:t.content.split(`
`).map((r,l)=>e.jsxs("span",{children:[r,e.jsx("br",{})]},l))}),t.imgUrls&&t.imgUrls.length>0&&e.jsx("hr",{className:"border-t border-dashed border-gray-200 dark:border-gray-600 my-4"}),t.imgUrls&&t.imgUrls.length>0&&e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2 pt-2",children:t.imgUrls.map(r=>{const l=r.startsWith("http")?r:`${R}${r}`;return e.jsx("button",{onClick:()=>s(l),className:"relative w-full aspect-square overflow-hidden rounded-lg border border-gray-200 hover:shadow-sm transition-shadow",type:"button",children:e.jsx("img",{src:l,alt:"첨부 이미지",className:"w-full h-full object-cover",onError:o=>{o.currentTarget.src=""}})},r)})}),n&&e.jsx(N,{src:n,alt:"첨부 이미지",onClose:()=>s(null)})]}):null},P=({inquiryId:t,onSuccess:n})=>{const[s,r]=d.useState(""),[l,o]=d.useState(!1),u=k(),a=d.useRef(null),m=async()=>{if(!/[^\s]/.test(s)){alert("답변 내용을 입력해주세요.");return}if(confirm("이 답변을 등록하시겠습니까?")){o(!0);try{await u.mutateAsync({inquiryId:t,data:{content:s}}),alert("답변이 등록되었습니다."),r(""),n()}catch(h){alert("답변 등록 중 오류가 발생했습니다."),console.error(h)}finally{o(!1)}}};return d.useEffect(()=>{const i=a.current;i&&(i.style.height="auto",i.style.height=`${i.scrollHeight}px`)},[s]),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 flex flex-col h-full",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-700 dark:text-white mb-6",children:"답변 등록"}),e.jsxs("div",{className:"relative flex-grow mb-2",children:[e.jsx("textarea",{ref:a,className:"w-full border border-gray-300 dark:border-gray-600 rounded p-3 pr-14 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-900 text-gray-900 dark:text-white overflow-hidden",value:s,onChange:i=>r(i.target.value),placeholder:"답변 내용을 입력하세요",disabled:l,rows:1,style:{minHeight:"300px"}}),e.jsxs("span",{className:"absolute bottom-2 right-3 text-sm text-gray-400 dark:text-gray-500",children:[s.length,"자"]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:m,disabled:l,className:"bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold  py-2 px-4 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"등록 중...":"답변 등록"})})]})},U=({inquiryId:t,onSuccess:n})=>{const[s,r]=d.useState(""),[l,o]=d.useState(!0),[u,a]=d.useState(null),m=I(),i=d.useRef(null);d.useEffect(()=>{(async()=>{o(!0),a(null);try{const x=await C(t);r((x==null?void 0:x.content)??"")}catch(x){a(x.message||"알 수 없는 오류가 발생했습니다."),r("")}finally{o(!1)}})()},[t]),d.useEffect(()=>{const c=i.current;c&&(c.style.height="auto",c.style.height=`${c.scrollHeight}px`)},[s]);const g=async()=>{if(!/[^\s]/.test(s)){alert("답변 내용을 입력해주세요.");return}if(confirm("이 답변을 수정하시겠습니까?"))try{await q(t,{content:s}),alert("답변이 수정되었습니다."),n()}catch(c){alert("답변 수정 중 오류가 발생했습니다."),console.error(c)}},h=async()=>{if(confirm("이 답변을 삭제하시겠습니까? 삭제 후 복구할 수 없습니다."))try{await m.mutateAsync(t),alert("답변이 삭제되었습니다."),n()}catch(c){alert("답변 삭제 중 오류가 발생했습니다."),console.error(c)}};return l?e.jsx("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"답변 내용을 불러오는 중입니다..."}):u?e.jsxs("div",{className:"p-6 text-center text-red-500 dark:text-red-400",children:["오류: ",u]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 h-full flex flex-col",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-700 dark:text-white mb-6",children:"답변 수정"}),e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("textarea",{ref:i,className:"w-full border border-gray-300 dark:border-gray-600 rounded p-3 pr-14 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-900 text-gray-900 dark:text-white overflow-hidden",value:s,onChange:c=>r(c.target.value),placeholder:"답변 내용을 수정하세요",disabled:l,rows:1,style:{minHeight:"300px"}}),e.jsxs("span",{className:"absolute bottom-2 right-3 text-sm text-gray-400 dark:text-gray-500",children:[s.length,"자"]})]}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsx("button",{onClick:g,disabled:l,className:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"답변 수정"}),e.jsx("button",{onClick:h,disabled:l,className:"bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:l?"삭제 중...":"답변 삭제"})]})]})};function $({data:t,isLoading:n,isError:s}){const r=p(),l=D(),u=`/admin/inquiries/list${b().search}`,a=async()=>{if(!t)return;const m=t.isDelete;if(confirm(m?"이 문의를 복구하시겠습니까?":"정말 이 문의를 삭제하시겠습니까?"))try{m?(await l.mutateAsync(t.inquiryId),alert("복구가 완료되었습니다.")):(await l.mutateAsync(t.inquiryId),alert("삭제가 완료되었습니다.")),r(0)}catch(g){alert(m?"복구 중 오류가 발생했습니다.":"삭제 중 오류가 발생했습니다."),console.error(g)}};return n?e.jsx(j,{isLoading:!0}):s||!t?e.jsx("div",{className:"p-4 text-red-500",children:"문의 정보 불러오기 실패"}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(w,{backgroundProfile:"bg-white/80 dark:bg-gradient-to-br dark:from-white/20 dark:to-transparent",avatarImage:t.userProfileImgUrl,name:t.userNickname,email:t.userEmail}),e.jsx("div",{className:"w-full mt-6",children:e.jsx(E,{data:t})}),e.jsxs("div",{className:"flex flex-col xl:flex-row gap-6 flex-grow mt-6",children:[e.jsx("div",{className:"w-full xl:w-1/2",children:e.jsx(L,{data:t})}),e.jsx("div",{className:"w-full xl:w-1/2 flex flex-col",children:t.status==="ANSWERED"?e.jsx("div",{children:e.jsx(U,{inquiryId:t.inquiryId,onSuccess:()=>r(0)})}):e.jsx("div",{children:e.jsx(P,{inquiryId:t.inquiryId,onSuccess:()=>r(0)})})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{onClick:a,className:`py-1.5 px-4 rounded-lg font-semibold ${t.isDelete?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:t.isDelete?"문의 복구":"문의 삭제"}),e.jsx("button",{onClick:()=>r(u),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 py-1.5 px-4 rounded-lg",children:"목록으로"})]})]})}function M(){const{id:t}=y(),n=Number(t),{data:s,isLoading:r,isError:l}=S({queryKey:["admin-inquiries",n],queryFn:()=>A(n).then(o=>o.data),enabled:n!==null});return e.jsx("div",{children:e.jsx($,{data:s,isLoading:r,isError:l})})}const le=f(M);export{le as default};
