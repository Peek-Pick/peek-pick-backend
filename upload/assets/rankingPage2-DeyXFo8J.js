import{w as q}from "./with-props-JNWkkrjn.js";import{p as K,v as V,t as z,a as o}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as r}from "./jsx-runtime-D_zvdyIk.js";import{u as G}from "./useInfiniteQuery-BFmOQqc-.js";import{I as N}from "./iconify-uWM87A7v.js";import{L as J}from "./listComponent-C0Baj83L.js";import{a as Q}from "./productsAPI-NkJZ08PW.js";import{a as _,F as M}from "./FloatingActionButtons-3zuONfQ9.js";import{u as H}from "./useTranslation-DnilsLqi.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./QueryClientProvider--V26__jT.js";import"./infiniteQueryBehavior-6_vRSK1h.js";import"./productLoading-CtBxAkDp.js";import"./index-Druiat5n.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./createLucideIcon-Cyt6UY_L.js";import"./i18nInstance-CHFDjdcJ.js";const c="rankingPageScrollY";function U(){var l;const i=performance.getEntriesByType("navigation").at(-1);return i&&"type"in i?i.type==="reload":((l=performance.navigation)==null?void 0:l.type)===1}const W=[{id:0,emoji:"🔥"},{id:1,emoji:"🍪"},{id:2,emoji:"🍙"},{id:3,emoji:"🍜"},{id:4,emoji:"🥐"},{id:5,emoji:"🍦"},{id:6,emoji:"🍬"},{id:7,emoji:"🥤"},{id:8,emoji:"🥪"},{id:9,emoji:"🍱"},{id:10,emoji:"🍎"},{id:11,emoji:"😡"},{id:12,emoji:"🍲"},{id:13,emoji:"🧂"},{id:14,emoji:"💪"},{id:15,emoji:"📦"}],he=q(function(){const{t:i,i18n:l}=H(),w=l.language,g=12,I=K(),m=V(),[y,h]=z(),d=o.useRef(!1),x=o.useRef(!0);o.useLayoutEffect(()=>("scrollRestoration"in window.history&&(window.history.scrollRestoration="manual"),x.current&&(U()&&(window.scrollTo(0,0),sessionStorage.removeItem(c),d.current=!1),x.current=!1),()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto")}),[]),o.useEffect(()=>{m!=="POP"&&(sessionStorage.removeItem(c),d.current=!1)},[m]);const R=Number(y.get("category")||"0"),[n,C]=o.useState(R),j=[{label:i("sortProductScore"),icon:"ri:star-fill",param:"score,DESC",color:"text-yellow-400"},{label:i("sortProductLike"),icon:"ri:heart-fill",param:"likeCount,DESC",color:"text-red-500"}],[a,E]=o.useState(y.get("sort")??"score,DESC"),[k,T]=o.useState(!0),v=o.useRef(0);o.useEffect(()=>{const t=()=>{const e=window.scrollY;T(e<=v.current||e<100),v.current=e};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[]);const L=a.split(",")[0],P=n===0?void 0:i(`productCategory.${n}`),{data:u,fetchNextPage:F,hasNextPage:Y,isFetchingNextPage:$,isLoading:O,isError:D}=G({queryKey:["productsRanking",g,a,P,w],queryFn:async({pageParam:t})=>{const e=t;return await Q(g,e==null?void 0:e.lastValue,e==null?void 0:e.lastProductId,P,a,w)},getNextPageParam: t=>{const e=t.content.at(-1);return!e||!t.hasNext?void 0:{lastValue:L==="score"?e.score:e.likeCount??0,lastProductId:e.productId}},initialPageParam:void 0,staleTime:5*60*1e3});o.useEffect(()=>{if(m==="POP"&&u&&!d.current){const t=sessionStorage.getItem(c);if(t){const{scrollY:e,fromDetail:s}=JSON.parse(t);s&&(window.scrollTo(0,e),requestAnimationFrame(()=>window.scrollTo(0,e))),sessionStorage.removeItem(c)}d.current=!0}},[m,u]);const A= t=>{sessionStorage.setItem(c,JSON.stringify({scrollY:window.scrollY,fromDetail:!0})),I(`/products/${t}`,{state:{fromDetail:!0}})};return r.jsxs("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:`sticky top-[3.625rem] z-40 transition-transform duration-300 ease-in-out ${k?"translate-y-0":"-translate-y-full"}`,children:r.jsx("div",{className:"px-4 py-2 bg-transparent",children:r.jsxs("div",{className:"flex flex-nowrap gap-2 items-center",children:[r.jsxs("div",{className:"relative",children:[r.jsx("select",{value:n,onChange: t=>{const e=Number(t.target.value);C(e);const s={sort:a};e!==0&&(s.category=String(e)),h(s),window.scrollTo(0,0)},className:"w-12 h-10 pl-2 pr-5 text-sm text-gray-900 bg-white border border-gray-300 rounded-lg appearance-none focus:outline-none",children:W.map(({id:t,emoji:e})=>r.jsxs("option",{value:t,children:[e," ",i(`productCategory.${t}`)]},t))}),r.jsx("div",{className:"pointer-events-none absolute right-1 top-1/2 transform -translate-y-1/2",children:r.jsx(N,{icon:"ri:arrow-down-s-line",className:"w-4 h-4 text-gray-500"})})]}),r.jsx("div",{className:"h-10 shadow-sm rounded-lg border border-gray-300",children:j.map(({label:t,param:e,icon:s,color:p}, S)=>{const B=a===e;return r.jsxs("button",{onClick:()=>{E(e);const f={};n!==0&&(f.category=String(n)),f.sort=e,h(f),window.scrollTo(0,0)},className:`
                                            py-2 px-4 inline-flex justify-center items-center gap-1 text-sm font-medium transition
                                            ${B?"h-10 text-gray-900 ring-2 ring-amber-400 ring-inset bg-white":"bg-white text-gray-900 hover:bg-gray-50"}
                                            ${S===0?"rounded-l-lg":""}
                                            ${S===j.length-1?"rounded-r-lg border-r-0":"border-r border-gray-300"}
                                        `,children:[r.jsx(N,{icon:s,className:`w-4 h-4 ${p}`}),t]},e)})})]})})}),r.jsx(J,{products:u?u.pages.flatMap((t,e)=>t.content.map((s,p)=>({...s,rank:e*g+p+1}))):[],fetchNextPage:F,hasNextPage:Y,isFetchingNextPage:$,isLoading:O,isError:D,onItemClick:A,isRanking:!0}),r.jsx(_,{where:"/main"}),r.jsx(M,{})]})});export{he as default};
