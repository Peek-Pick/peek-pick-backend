import{w as I}from "./with-props-JNWkkrjn.js";import{a as i,p as B,t as T}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as e}from "./jsx-runtime-D_zvdyIk.js";import{u as $}from "./useQuery-CxabGwVz.js";import{u as K,g as O}from "./adminUsersAPI-DY3ReOB7.js";import{u as F}from "./QueryClientProvider--V26__jT.js";import{L as V}from "./loadingComponent-BmsJ8g5Y.js";import{P as q}from "./PaginationComponent-CiWrhgCU.js";import{F as M,g as Q}from "./index-DP0VIuDs.js";import"./index-Druiat5n.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./chevron-left-i71DKoJD.js";import"./createLucideIcon-Cyt6UY_L.js";import"./chevron-right-WLYf1NvF.js";function z({isOpen:t,onClose:o,userId:m,onSubmit:c,error:h,loading:u}){const[l,n]=i.useState("ACTIVE"),[d,a]=i.useState(3),N=()=>{let r;if(l==="BANNED"){const y=new Date;y.setDate(y.getDate()+d),r=y.toISOString().split("T")[0]}c(l,r)};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30",style:{backgroundColor:"rgba(169, 169, 169, 0.7)"},children:e.jsxs("div",{className:"bg-white rounded p-6 w-[90%] max-w-md shadow-lg relative",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"사용자 상태 변경"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("select",{className:"w-full border rounded p-2",value:l,onChange: r=>n(r.target.value),children:[e.jsx("option",{value:"ACTIVE",children:"ACTIVE"}),e.jsx("option",{value:"DELETED",children:"DELETED"}),e.jsx("option",{value:"BANNED",children:"BANNED"})]}),l==="BANNED"&&e.jsx("div",{className:"flex gap-2",children:[3,7,15].map(r=>e.jsxs("button",{onClick:()=>a(r),className:`px-3 py-1 rounded border ${d===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"}`,children:[r,"일"]},r))}),h&&e.jsx("p",{className:"text-sm text-red-500",children:h})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-300 text-sm rounded hover:bg-gray-400",onClick:o,disabled:u,children:"취소"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50",onClick:N,disabled:u,children:u?"변경 중...":"변경"})]})]})}):null}function R(){const[t,o]=i.useState(!1),[m,c]=i.useState(null);return{updateStatus:async({userId:u,updateStatus:l})=>{var n,d;o(!0),c(null);try{return await K(u,{status:l.status,banUntil:l.status==="BANNED"?l.banUntil:void 0}),!0}catch(a){c(((d=(n=a.response)==null?void 0:n.data)==null?void 0:d.message)||"There was an error while updating the status.")}finally{o(!1)}},loading:t,error:m}}function G({users:t,isLoading:o,isError:m,page:c,category:h,keyword:u,userStatus:l,social:n}){const d=B(),[a,N]=i.useState(t),{updateStatus:r,loading:y,error:S}=R(),[f,x]=i.useState(!1),[b,g]=i.useState(null),w=F();i.useEffect(()=>{N(t)},[t]);const C= s=>{const j=`from=userList&page=${c}&keyword=${u}&category=${h}&userStatus=${l}&social=${n}`;d(`/admin/users/${s}?${j}`)},E= s=>{g(s),x(!0)},v=()=>{x(!1),g(null)},U=async(s, j)=>{if(b===null)return;await r({userId:b,updateStatus:{status:s,banUntil:j}})&&(await Promise.all([w.invalidateQueries({queryKey:["adminUserList"],exact:!1})]),v())};return o?e.jsx(V,{isLoading:!0}):m||!a?e.jsx("div",{className:"p-4 text-red-500",children:"유저 목록 불러오기 실패"}):e.jsx("div",{children:e.jsxs("div",{className:"overflow-x-auto bg-white shadow rounded-lg",children:[e.jsxs("table",{className:"min-w-full text-sm divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"email"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"type"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"status"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Change"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-3 text-center text-gray-500",children:"등록된 사용자 없음"})}):a.map(s=>e.jsxs("tr",{onClick:()=>C(s.userId),className:"hover:bg-gray-100 cursor-pointer text-sm",children:[e.jsx("td",{className:"px-4 py-4",children:s.userId}),e.jsx("td",{className:"px-4 py-4",children:s.email}),e.jsx("td",{className:"px-4 pp-4",children:s.isSocial?"Social":"Local"}),e.jsx("td",{className:"px-4 py-4",children:s.status==="BANNED"&&s.banUntil?`BANNED (~${s.banUntil})`:s.status}),e.jsx("td",{className:"px-4",children:e.jsx("button",{onClick: j=>{j.stopPropagation(),E(s.userId)},className:"px-2 py-1 h-7 bg-blue-500 text-white text-xs rounded hover:bg-blue-600",children:"Change"})})]},s.userId))})]}),f&&b!==null&&e.jsx(z,{isOpen:f,onClose:v,userId:b,onSubmit:U,loading:y,error:S})]})})}function H({category:t,setCategory:o,keyword:m,setKeyword:c,onSearch:h,userStatus:u,setUserStatus:l,social:n,setSocial:d}){return e.jsxs("div",{className:"flex justify-between items-center mb-2 text-sm bg-white p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:t,onChange: a=>{o(a.target.value),c("")},className:"border border-gray-300 rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"전체"}),e.jsx("option",{value:"userId",children:"유저번호"}),e.jsx("option",{value:"email",children:"이메일"})]}),e.jsx("input",{type:"text",value:m,onChange: a=>c(a.target.value),placeholder:"키워드를 입력하세요",className:"border border-gray-300 rounded-lg px-4 py-1.5 w-64 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:t==="all"}),e.jsx("button",{onClick:h,className:"bg-blue-600 text-white px-5 py-1.5 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition",disabled:t!=="all"&&m.trim()==="",children:"검색"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",id:"socialOnly",checked:n,onChange: a=>d(a.target.checked)}),e.jsx("label",{htmlFor:"socialOnly",className:"text-sm text-gray-700",children:"소셜 계정만 보기"})]}),e.jsxs("select",{value:u,onChange: a=>l(a.target.value),className:" flex items-center gap-1 border border-gray-300 rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"전체 상태"}),e.jsx("option",{value:"ACTIVE",children:"ACTIVE"}),e.jsx("option",{value:"BANNED",children:"BANNED"}),e.jsx("option",{value:"DELETED",children:"DELETED"})]})]})]})}function J(){const[t,o]=T(),m=t.get("category")||"all",c=t.get("keyword")||"",h=Number(t.get("page")||"0"),u=t.get("userStatus")||"",l=t.get("social")==="true",[n,d]=i.useState(m),[a,N]=i.useState(c),[r,y]=i.useState(c),[S,f]=i.useState(h),[x,b]=i.useState(u),[g,w]=i.useState(l);i.useEffect(()=>{const p=t.get("category")||"all",k=t.get("keyword")||"",L=Number(t.get("page")||"0"),P=t.get("userStatus")||"",A=t.get("social")==="true";d(p),N(k),y(k),f(L),b(P),w(A)},[t]);const C= p=>{b(p),f(0),o({category:n,keyword:a,userStatus:p,social:g.toString(),page:"0"})},E= p=>{w(p),o({category:n,keyword:a,userStatus:x,social:p.toString(),page:"0"}),f(0)},v=()=>{N(r),o({category:n,keyword:r,userStatus:x,social:g.toString(),page:"0"}),f(0)},U= p=>{o({category:n,keyword:a,social:g.toString(),page:p.toString()}),f(p)},{data:s,isLoading:j,isError:D}=$({queryKey:["adminUserList",S,n,a,x,g],queryFn:()=>O(S,n,a,x,g)});return console.log(x),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(M,{icon:Q,style:{width:"20px",height:"20px"}})," 전체 사용자 목록"]}),e.jsx(H,{category:n,setCategory:d,keyword:r,setKeyword:y,userStatus:x,setUserStatus:C,social:g,setSocial:E,onSearch:v}),e.jsx(G,{users:s==null?void 0:s.content,isLoading:j,isError:D,page:S,category:n,keyword:a,userStatus:x,social:g}),e.jsx(q,{currentPage:S,totalPages:s==null?void 0:s.totalPages,onPageChange:U,maxPageButtons:10})]})}const ge=I(J);export{ge as default};
