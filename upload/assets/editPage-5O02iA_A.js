import{w as v}from "./with-props-JNWkkrjn.js";import{p as w,a as i,w as N}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as e}from "./jsx-runtime-D_zvdyIk.js";import{u as C}from "./QueryClientProvider--V26__jT.js";import{u as x}from "./useMutation-iBKtBQ4J.js";import{P as k}from "./points-A4FasJQU.js";import{F as E,t as q}from "./index-DP0VIuDs.js";import{u as F,d as S,r as P}from "./adminPointsAPI-6xBe1sfk.js";import{u as T}from "./useQuery-CxabGwVz.js";import"./index-Druiat5n.js";import{L as U}from "./loadingComponent-BmsJ8g5Y.js";import"./mutation-CruqbX-z.js";import"./removable-CGh8wCEh.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./useBaseQuery-BTSvK_Q6.js";import"./query-CjmfnAM3.js";function D({idNumber:o,data:t}){const l=w(),n=i.useRef(null),[u,m]=i.useState("파일을 선택하세요"),c=i.useRef(null),d=C(),[a,p]=i.useState(!1),f=x({mutationFn: r=>F(o,r),onSuccess:()=>{d.invalidateQueries({queryKey:["pointsList"]}),alert("수정 완료!"),l("/admin/points/list")},onError:()=>{alert("수정 실패")}});i.useEffect(()=>{t&&p(!!t.hidden)},[t]);const g=x({mutationFn:()=>S(o??0),onSuccess:()=>{d.invalidateQueries({queryKey:["pointsList"]}),p(!a),alert(a?"판매 시작됨!":"판매 중단됨!"),l("/admin/points/list")},onError:()=>{alert("삭제 실패")}}),b=()=>{confirm(a?"판매를 시작하시겠습니까?":"판매를 중단하시겠습니까?")&&g.mutate()},y= r=>{r.preventDefault();const s=n.current;if(!s)return;const j={imageFile:c.current.files[0],item:s.item.value,price:Number(s.price.value),description:s.description.value,productType:s.productType.value,imgUrl:(t==null?void 0:t.imgUrl)||""};f.mutate(j)},h= r=>{r.target.files&&r.target.files.length>0?m(r.target.files[0].name):m("파일을 선택하세요")};return i.useEffect(()=>{if(!t||!n.current)return;const r=n.current;r.item.value=t.item,r.price.value=t.price.toString(),r.description.value=t.description,r.productType.value=t.productType;const s=r.querySelector('input[name="imgUrl"]');s&&(s.value=t.imgUrl??"")},[t]),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 text-gray-800 max-w-2xl mx-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 border-b pb-2 flex items-center gap-2",children:[e.jsx(E,{icon:q}),"상품 수정"]}),e.jsxs("form",{ref:n,onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wide",children:"상품명"}),e.jsx("input",{type:"text",name:"item",className:"w-full border border-gray-200 rounded-md px-3 py-2 text-gray-900 shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wide",children:"가격"}),e.jsx("input",{type:"number",name:"price",className:"w-full border border-gray-200 rounded-md px-3 py-2 text-gray-900 shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wide",children:"설명"}),e.jsx("textarea",{name:"description",rows:4,className:"w-full border border-gray-200 rounded-md px-3 py-2 text-gray-900 shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 whitespace-pre-line leading-relaxed",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wide",children:"상품 타입"}),e.jsxs("select",{name:"productType",className:"w-full border border-gray-200 rounded-md px-3 py-2 text-gray-900 shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"선택"}),Object.entries(k).map(([r,s])=>e.jsx("option",{value:r,children:s},r))]})]}),e.jsx("input",{type:"hidden",name:"imgUrl",value:(t==null?void 0:t.imgUrl)??""}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"이미지 파일"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{var r;return(r=c.current)==null?void 0:r.click()},className:"flex items-center gap-1 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-100 hover:text-gray-800 transition",children:"파일 선택"}),e.jsx("span",{className:"text-gray-600 truncate max-w-xs",children:u})]}),e.jsx("input",{type:"file",name:"imageFile",accept:"image/*",className:"hidden",ref:c,onChange:h})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"submit",className:"flex items-center gap-1 rounded-md bg-blue-100 px-4 py-2 text-sm font-medium text-blue-700 shadow-sm hover:bg-blue-200 transition",children:"수정"}),e.jsx("button",{type:"button",onClick:b,className:"flex items-center gap-1 rounded-md bg-red-100 px-4 py-2 text-sm font-medium text-red-700 shadow-sm hover:bg-red-200 transition",children:a?"판매 시작하기":"판매 중단하기"})]})]})]})}function L(){const{id:o}=N(),t=o?parseInt(o,10):null,{data:l,isLoading:n,isError:u}=T({queryKey:["product",t],queryFn:()=>P(t),enabled:t!==null});return n?e.jsx(U,{isLoading:!0}):u||!l?e.jsx("div",{className:"p-4 text-red-500",children:"에러 발생"}):e.jsx("div",{children:e.jsx(D,{data:l,idNumber:t})})}const _=v(L);export{_ as default};
