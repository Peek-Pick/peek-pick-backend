import{w as H}from "./with-props-JNWkkrjn.js";import{p as M,v as U,t as W,a as s}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as o}from "./jsx-runtime-D_zvdyIk.js";import{u as X}from "./useInfiniteQuery-BFmOQqc-.js";import{I as y}from "./iconify-uWM87A7v.js";import{L as Z}from "./listComponent-C0Baj83L.js";import{s as ee,d as te}from "./productsAPI-NkJZ08PW.js";import{a as oe,F as re}from "./FloatingActionButtons-3zuONfQ9.js";import{P as se}from "./productLoading-CtBxAkDp.js";import{u as ae}from "./useTranslation-DnilsLqi.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./QueryClientProvider--V26__jT.js";import"./infiniteQueryBehavior-6_vRSK1h.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./createLucideIcon-Cyt6UY_L.js";import"./index-Druiat5n.js";import"./i18nInstance-CHFDjdcJ.js";const ne=[{id:1,emoji:"🍪",label:{ko:"과자류",en:"Snacks",ja:"スナック",zh:"零食"}},{id:2,emoji:"🍙",label:{ko:"삼각김밥/김밥",en:"Kimbap/Onigiri",ja:"キンパ/おにぎり",zh:"紫菜包饭/饭团"}},{id:3,emoji:"🍜",label:{ko:"면류",en:"Noodles",ja:"麺類",zh:"面类"}},{id:4,emoji:"🥐",label:{ko:"빵/디저트",en:"Bread/Dessert",ja:"パン/デザート",zh:"面包/甜点"}},{id:5,emoji:"🍦",label:{ko:"아이스크림",en:"Ice Cream",ja:"アイスクリーム",zh:"冰淇淋"}},{id:6,emoji:"🍬",label:{ko:"캔디/껌",en:"Candy/Gum",ja:"キャンディ/ガム",zh:"糖果/口香糖"}},{id:7,emoji:"🥤",label:{ko:"음료",en:"Drinks",ja:"飲料",zh:"饮料"}},{id:8,emoji:"🥪",label:{ko:"샌드위치/햄버거",en:"Sandwich/Burger",ja:"サンドイッチ/ハンバーガー",zh:"三明治/汉堡"}},{id:9,emoji:"🍱",label:{ko:"도시락",en:"Lunch Box",ja:"弁当",zh:"便当"}},{id:10,emoji:"🍎",label:{ko:"과일/샐러드",en:"Fruit/Salad",ja:"フルーツ/サラダ",zh:"水果/沙拉"}},{id:11,emoji:"😡",label:{ko:"즉석섭취식품",en:"Ready-to-Eat",ja:"すぐに食べられる",zh:"即食食品"}},{id:12,emoji:"🍲",label:{ko:"즉석조리식품",en:"Instant to Cook",ja:"簡単な調理が必要",zh:"需简单加热"}},{id:13,emoji:"🧂",label:{ko:"식재료",en:"Ingredients",ja:"材料",zh:"食材"}},{id:14,emoji:"💪",label:{ko:"건강식품",en:"Health Food",ja:"健康食品",zh:"保健食品"}},{id:15,emoji:"📦",label:{ko:"기타",en:"Other",ja:"その他",zh:"其他"}}];function ie(w){return ne.map(({id:i,emoji:l,label:m})=>({id:i,emoji:l,label:m[w]??m.ko}))}const p="searchPageScrollY";function le(){var l;const i=performance.getEntriesByType("navigation").at(-1);return i&&"type"in i?i.type==="reload":((l=performance.navigation)==null?void 0:l.type)===1}const Ie=H(function(){const l=M(),m=U(),[j,x]=W(),{t:a,i18n:v}=ae(),b=v.language,h=s.useRef(!1),P=s.useRef(!0),C=s.useRef(0),[L,F]=s.useState(!0),c=j.get("keyword")??"",B=parseInt(j.get("category")??"0",10),O=j.get("sort")??"_score,DESC",[u,z]=s.useState(c),[n,Y]=s.useState(B),[d,$]=s.useState(O),S=d.split(",")[0],D=v.language,_=ie(D),K=[{id:0,emoji:"🔥",label:a("productCategory.0")},..._],k=n===0?void 0:a(`productCategory.${n}`),N=[{label:a("sortProductMatch"),icon:"ri:sparkling-2-fill",param:"_score,DESC",color:"text-green-500"},{label:a("sortProductLike"),icon:"ri:heart-fill",param:"likeCount,DESC",color:"text-red-500"},{label:a("sortProductScore"),icon:"ri:star-fill",param:"score,DESC",color:"text-yellow-400"}],{data:g,fetchNextPage:V,hasNextPage:A,isFetchingNextPage:q,isLoading:I,isError:G}=X({queryKey:["productsSearch",12,d,k,c,b],queryFn:async({pageParam:e=0})=>{if(S==="_score")return await ee(12,e,k,c,b);{const t=e;return(await te(12,t==null?void 0:t.lastValue,t==null?void 0:t.lastProductId,k,c,d,b)).content}},getNextPageParam:(e, t)=>{if(S==="_score"){const r=e,f=t.length;return r.length===12?f:void 0}else{const r=e.at(-1);return r?{lastValue:S==="score"?r.score??0:r.likeCount??0,lastProductId:r.productId}:void 0}},initialPageParam:0,enabled:c.trim()!=="",staleTime:1e3*60*5});s.useLayoutEffect(()=>("scrollRestoration"in window.history&&(window.history.scrollRestoration="manual"),P.current&&(le()&&(window.scrollTo(0,0),sessionStorage.removeItem(p),h.current=!1),P.current=!1),()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto")}),[]),s.useEffect(()=>{m!=="POP"&&(sessionStorage.removeItem(p),h.current=!1)},[m]),s.useEffect(()=>{if(!h.current&&g){const e=sessionStorage.getItem(p);if(e){const r=JSON.parse(e).scrollY;r>0&&(window.scrollTo(0,r),requestAnimationFrame(()=>window.scrollTo(0,r))),sessionStorage.removeItem(p)}h.current=!0}},[g]),s.useEffect(()=>{const e=()=>{const t=window.scrollY;F(t<=C.current||t<100),C.current=t};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]);const E=()=>{const e=u.trim();if(e){const t={keyword:e,sort:d};n!==0&&(t.category=n.toString()),x(t),window.scrollTo(0,0)}},J= e=>{sessionStorage.setItem(p,JSON.stringify({scrollY:window.scrollY})),l(`/products/${e}`,{state:{fromSearch:!0}})};return I?o.jsx(se,{}):o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsx("div",{className:`sticky top-[3.625rem] z-40 transition-transform duration-300 ease-in-out ${L?"translate-y-0":"-translate-y-full"}`,children:o.jsxs("div",{className:"px-4 py-2 bg-transparent",children:[o.jsxs("div",{className:"relative w-full",children:[o.jsx("select",{value:n,onChange: e=>{const t=parseInt(e.target.value,10);Y(t);const r={keyword:u.trim(),sort:d};t!==0&&(r.category=t.toString()),x(r),window.scrollTo(0,0)},className:"absolute left-0 top-0 z-10 w-16 h-10 pl-3 pr-8 text-sm text-gray-900 rounded-lg appearance-none focus:outline-none",children:K.map(({id:e,emoji:t})=>o.jsxs("option",{value:e,children:[t," ",a(`productCategory.${e}`)]},e))}),o.jsx("div",{className:"pointer-events-none absolute left-10 top-1/2 z-20 transform -translate-y-1/2",children:o.jsx(y,{icon:"ri:arrow-down-s-line",className:"w-4 h-4 text-gray-500"})}),o.jsx("input",{type:"text",placeholder:a("productSearch"),className:"w-full h-10 pl-17 pr-10 text-sm text-gray-900 bg-white border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none",value:u,onChange: e=>z(e.target.value),onKeyDown: e=>{e.key==="Enter"&&E()}}),u&&o.jsx("button",{onClick:()=>z(""),className:"absolute right-10 top-1/2 transform -translate-y-1/2 p-1",children:o.jsx(y,{icon:"ri:close-line",className:"w-4 h-4 text-gray-600"})}),o.jsx("button",{onClick:E,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1",children:o.jsx(y,{icon:"ri:search-line",className:"w-5 h-5 text-gray-600"})})]}),o.jsx("div",{className:"flex justify-center w-full mt-2",children:o.jsx("div",{className:"inline-flex shadow-sm rounded-lg overflow-hidden border border-gray-300",children:N.map(({label:e,param:t,icon:r,color:f}, R)=>{const Q=d===t;return o.jsxs("button",{onClick:()=>{$(t);const T={keyword:u.trim(),sort:t};n!==0&&(T.category=n.toString()),x(T),window.scrollTo(0,0)},className:`
                      py-2 px-4 inline-flex justify-center items-center gap-1 text-sm font-medium transition
                      ${Q?"text-gray-900 ring-2 ring-amber-400 ring-inset bg-white":"bg-white text-gray-900 hover:bg-gray-50"}
                      ${R===0?"rounded-l-lg":""}
                      ${R===N.length-1?"rounded-r-lg border-r-0":"border-r border-gray-300"}
                    `,children:[o.jsx(y,{icon:r,className:`w-4 h-4 ${f}`}),e]},t)})})})]})}),c.trim()!==""&&o.jsx(Z,{products:(g==null?void 0:g.pages.flat())??[],fetchNextPage:V,hasNextPage:A,isFetchingNextPage:q,isLoading:I,isError:G,onItemClick:J}),o.jsx(oe,{where:"/main"}),o.jsx(re,{})]})});export{Ie as default};
