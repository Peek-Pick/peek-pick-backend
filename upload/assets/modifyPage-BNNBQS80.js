import{w as W}from "./with-props-JNWkkrjn.js";import{a as m,p as _,w as q}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as t}from "./jsx-runtime-D_zvdyIk.js";import{u as A}from "./useQuery-CxabGwVz.js";import{m as V,h as J,i as Q}from "./reviewAPI-zRekXALF.js";import{u as z}from "./useMutation-iBKtBQ4J.js";import{u as H}from "./useTagSelector-B0AbEUZv.js";import{a as X}from "./rating-s5hnHQfB.js";import{R as Y}from "./reviewLoading-C78wslp8.js";import{i as Z}from "./react-textarea-autosize.browser.esm-Dj6DKNmx.js";import{B as tt}from "./FloatingActionButtons-3zuONfQ9.js";import{S as i}from "./sweetalert2.esm.all-9Qm2jZ7z.js";/* empty css                   */import{u as I}from "./useTranslation-DnilsLqi.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./QueryClientProvider--V26__jT.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./mutation-CruqbX-z.js";import"./index-Druiat5n.js";import"./createLucideIcon-Cyt6UY_L.js";import"./i18nInstance-CHFDjdcJ.js";function et({review:e,isLoading:f,isError:x}){const{t:o}=I(),r=m.useRef(null),u=_(),[h,b]=m.useState((e==null?void 0:e.score)??0),[j,y]=m.useState((e==null?void 0:e.comment)??""),[R,w]=m.useState([]),[S,N]=m.useState([]),[k,v]=m.useState([]),[O,B]=m.useState((e==null?void 0:e.images)||[]),d=m.useMemo(()=>{var s;return((s=e==null?void 0:e.tagList)==null?void 0:s.map(n=>n.tagId))||[]},[e]),{selectedTags:p,toggleTag:E,setSelectedTags:F,groupedTags:L}=H(d),{deleteTagIds:D,newTagIds:K}=m.useMemo(()=>{const s=new Set(d),n=new Set(p),a=d.filter(l=>!n.has(l)),c=p.filter(l=>!s.has(l));return{deleteTagIds:a,newTagIds:c}},[d,p]);m.useEffect(()=>{var s;e&&(b(e.score),y(e.comment??""),B(e.images||[]),F(((s=e.tagList)==null?void 0:s.map(n=>n.tagId))||[]))},[e]);const P= s=>{if(!s.target.files)return;const n=Array.from(s.target.files);w(a=>[...a,...n]),N(a=>[...a,...n.map(c=>URL.createObjectURL(c))])},$= s=>{v(n=>[...n,s]),B(n=>n.filter(a=>a.imgId!==s))},M= s=>{w(n=>n.filter((a, c)=>c!==s)),N(n=>n.filter((a, c)=>c!==s))},T=z({mutationFn: s=>(i.fire({title:o("updatingReview"),allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{i.showLoading()},customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then(),V(e.reviewId,s)),onSuccess:()=>{i.fire({title:o("updatingReviewSuccess"),icon:"success",confirmButtonText:o("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then(()=>{u(`/reviews/${e.reviewId}`,{replace:!0})})},onError:()=>{i.fire({title:o("updatingReviewFail"),icon:"error",confirmButtonText:o("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then()}}),U= s=>{var l,C;if(s.preventDefault(),!e)return;if(!((C=(l=r.current)==null?void 0:l.comment.value)==null?void 0:C.trim())){i.fire({title:o("submittingReviewCheck"),icon:"warning",confirmButtonText:o("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then();return}const a={reviewId:e.reviewId,score:h,comment:j,deleteImgIds:k,deleteTagIds:D,newTagIds:K},c=new FormData;c.append("review",new Blob([JSON.stringify(a)],{type:"application/json"})),R.forEach(g=>c.append("files",g)),i.fire({title:o("updatingReviewConfirm"),text:o("updatingReviewWarning"),icon:"warning",showCancelButton:!0,confirmButtonText:o("confirmUpdateButtonText"),cancelButtonText:o("cancelButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button",cancelButton:"custom-cancel-button"}}).then(g=>{g.isConfirmed&&T.mutate(c)})},G=async()=>{if((await i.fire({title:o("deleteReviewConfirm"),text:o("deleteReviewWarning"),icon:"warning",showCancelButton:!0,confirmButtonText:o("confirmDeleteButtonText"),cancelButtonText:o("cancelButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button",cancelButton:"custom-cancel-button"}})).isConfirmed)try{i.fire({title:o("deletingReview"),allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{i.showLoading()},customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}),await J(e.reviewId),await i.fire({title:o("deletingReviewSuccess"),icon:"success",confirmButtonText:o("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}),u("/reviews/user",{replace:!0})}catch(n){console.error(n),await i.fire({title:o("deletingReviewFail"),icon:"error",confirmButtonText:o("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}})}};return f?t.jsx(Y,{}):x||!e?t.jsx("p",{className:"text-center p-4 text-red-500 text-base sm:text-lg",children:o("reviewLoadError")}):t.jsx("section",{className:"py-12",children:t.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 md:px-8",children:[t.jsxs("div",{className:"flex flex-col items-center mb-8",children:[t.jsx("img",{src:`https://myapp.peek-pick.click${e==null?void 0:e.imageUrl}`||"/example.jpg",alt:(e==null?void 0:e.name)||"Product Image",className:"w-40 h-40 sm:w-40 sm:h-40 md:w-40 md:h-40 rounded-lg object-cover mb-"}),t.jsx("p",{className:"text-base sm:text-base md:text-md font-semibold text-gray-800 text-center",children:e==null?void 0:e.name})]}),t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h3",{className:"font-manrope font-bold text-lg sm:text-xl text-gray-700 mb-4",children:o("reviewAddGuide")}),t.jsx("div",{className:"flex justify-center space-x-2",children:[1,2,3,4,5].map(s=>t.jsx("button",{onClick:()=>b(s),className:"transform transition hover:scale-110 focus:outline-none","aria-label":`${s}점`,children:t.jsx(X,{filled:s<=h})},s))})]}),t.jsxs("form",{ref:r,onSubmit:U,className:"space-y-6",children:[t.jsx(Z,{name:"comment",minRows:6,maxRows:15,value:j,onChange: s=>y(s.target.value),placeholder:o("reviewCommentGuide"),className:"w-full border text-gray-600 border-gray-300 rounded-md p-3 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-gray-300"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-800 mb-2 text-base sm:text-base",children:o("tagSelectGuide")}),t.jsx("div",{className:"space-y-4",children:Object.entries(L).map(([s,n])=>t.jsxs("div",{className:"w-full",children:[t.jsx("p",{className:"text-sm sm:text-base font-semibold text-gray-600 mb-2",children:o(`categories.${s}`)}),t.jsx("div",{className:"flex overflow-x-auto no-scrollbar space-x-2 px-1 pb-1 -mx-1",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:n.map(a=>t.jsx("button",{type:"button",onClick:()=>E(a.tagId),className:`whitespace-nowrap px-3 py-1 text-sm sm:text-sm rounded-full border transition-colors
                                                    ${p.includes(a.tagId)?"bg-emerald-50 text-emerald-500 border-emerald-200":"bg-gray-100 text-gray-500 border-gray-400"}`,children:o(`tags.${a.tagName}`)},a.tagId))})]},s))})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-base sm:text-base text-gray-800 mb-2",children:o("editPhotoGuide")}),t.jsxs("div",{className:"w-full overflow-x-auto no-scrollbar flex space-x-2",children:[t.jsxs("label",{className:"w-25 h-25 sm:w-25 sm:h-25 flex-shrink-0 flex items-center justify-center border-2 border-dashed rounded-md text-gray-400 cursor-pointer",children:[t.jsx("span",{className:"text-2xl",children:"＋"}),t.jsx("input",{type:"file",name:"files",multiple:!0,accept:"image/*",onChange:P,className:"hidden"})]}),O.map(s=>t.jsxs("div",{className:"relative w-25 h-25 sm:w-25 sm:h-25 flex-shrink-0 rounded-lg overflow-hidden border border-gray-300",children:[t.jsx("img",{src:`https://myapp.peek-pick.click/reviews/s_${s.imgUrl}`,alt:"기존 이미지",className:"w-full h-full object-cover"}),t.jsx("button",{type:"button",onClick:()=>$(s.imgId),className:"absolute top-1 right-1 bg-black/50 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:"×"})]},s.imgId)),S.map((s,n)=>t.jsxs("div",{className:"relative w-25 h-25 sm:w-25 sm:h-25 flex-shrink-0 rounded-md overflow-hidden border",children:[t.jsx("img",{src:s,alt:"추가 이미지",className:"w-full h-full object-cover"}),t.jsx("button",{type:"button",onClick:()=>M(n),className:"absolute top-1 right-1 bg-black/50 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:"×"})]},n))]})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{type:"button",onClick:G,className:"w-full px-4 py-2 font-medium rounded-md text-sm sm:text-sm transition-colors bg-gray-400 text-white cursor-not-allowed",children:o("deleteReviewButton")}),t.jsx("button",{type:"submit",disabled:T.isPending,className:"w-full px-4 py-2 font-medium rounded-md text-sm sm:text-sm transition-colors bg-emerald-400 text-white hover:bg-emerald-600",children:o("updateReviewButton")})]})]}),t.jsx(tt,{})]})})}function st(){const{rid:e}=q(),{i18n:f}=I(),x=f.language,{data:o,isLoading:r,isError:u}=A({queryKey:["review",Number(e)],queryFn:()=>Q(Number(e),x)});return t.jsx("div",{children:t.jsx(et,{review:o==null?void 0:o.data,isLoading:r,isError:u})})}const Rt=W(st);export{Rt as default};
