import{w as S}from "./with-props-JNWkkrjn.js";import{a as m,p as v}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as e}from "./jsx-runtime-D_zvdyIk.js";import{u as w}from "./useQuery-CxabGwVz.js";import{c as M,i as C}from "./axiosInstance-CCaw23o5.js";import{B as F}from "./bottomNavComponent-Bso_MVxF.js";import{C as T}from "./chevron-left-i71DKoJD.js";import{C as I}from "./chevron-right-WLYf1NvF.js";import{u as g}from "./useTranslation-DnilsLqi.js";import{a as L,b as P}from "./productsAPI-NkJZ08PW.js";import{I as b}from "./iconify-uWM87A7v.js";import{g as R,a as A}from "./settingFCM-Bgyar-YB.js";import{S as B}from "./sweetalert2.esm.all-9Qm2jZ7z.js";import{a as E}from "./index-Bk2RvI0-.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./QueryClientProvider--V26__jT.js";import"./index-xsH4HHeE.js";import"./createLucideIcon-Cyt6UY_L.js";import"./i18nInstance-CHFDjdcJ.js";function W(){const{data:s=!1,isLoading:n}=w({queryKey:["auth-check"],queryFn:M,retry:0});return{isLoggedIn:s,isLoading:n}}const j=["/carousel/review_event.png","/carousel/bingsu.png","/carousel/invitation.png","/carousel/summer_event.png","/carousel/best_photo_review.png"];function _(){const[s,n]=m.useState(0),t=j.length,r=()=>n(i=>(i+1)%t),d=()=>n(i=>(i-1+t)%t);return m.useEffect(()=>{const i=setInterval(r,5e3);return()=>clearInterval(i)},[s]),e.jsxs("div",{className:"relative w-full overflow-hidden h-[50vh]",children:[e.jsx("div",{className:"flex transition-transform duration-700 ease-in-out",style:{transform:`translateX(-${s*100}%)`},children:j.map((i, l)=>e.jsx("img",{src:i,alt:`Slide ${l+1}`,className:"w-full flex-shrink-0 object-cover h-[50vh]"},l))}),e.jsx("button",{onClick:d,className:"absolute top-1/2 left-2 bg-white/50 hover:bg-white rounded-full p-2 shadow","aria-label":"Previous slide",children:e.jsx(T,{className:"w-6 h-6"})}),e.jsx("button",{onClick:r,className:"absolute top-1/2 right-2 bg-white/50 hover:bg-white rounded-full p-2 shadow","aria-label":"Next slide",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:j.map((i, l)=>e.jsx("button",{onClick:()=>n(l),className:`w-3 h-3 rounded-full ${s===l?"bg-white":"bg-white/50"}`,"aria-label":`Go to slide ${l+1}`},l))})]})}const z=()=>{const{t:s}=g(),n=v(),t=[{icon:"/icons/main_barcode.png",label:s("mainBarcode"),to:"/barcode/scan"},{icon:"/icons/main_favorite.png",label:s("mainWishList"),to:"/mypage/favorites"},{icon:"/icons/main_event.png",label:s("mainEvent"),to:"/notices/list"},{icon:"/icons/main_map.png",label:s("mainNearbyStores"),to:"/map"},{icon:"/icons/main_chatbot.png",label:s("mainAIChatBot"),to:"/chatbot"},{icon:"/icons/main_ranking.png",label:s("mainRanking"),to:"/products/ranking"}];return e.jsx("div",{className:"container relative z-40 mx-auto mt-4 mb-4",children:e.jsx("div",{className:"grid grid-cols-3",children:t.map((r, d)=>e.jsxs("button",{onClick:()=>n(r.to),className:"flex flex-col items-center justify-center py-6 shadow-sm bg-white hover:bg-gray-50",children:[e.jsx("img",{src:r.icon,alt:r.label,className:"w-10 h-10"}),e.jsx("span",{className:"pt-2 text-m font-medium text-gray-700",children:r.label})]},d))})})};function q(){const{t:s,i18n:n}=g(),t=n.language,r=v(),d=m.useRef(null),i=10,l="score,DESC",{data:c,isLoading:x,isError:f}=w({queryKey:["productsRanking",i,l],queryFn:()=>L(i,void 0,void 0,void 0,l,t),staleTime:1e3*60*5}),a=(c==null?void 0:c.content)??[];return m.useEffect(()=>{const o=d.current;if(!o)return;const u=168*2,h=setInterval(()=>{if(!o)return;const k=o.scrollWidth-o.clientWidth;o.scrollLeft+u>=k?o.scrollTo({left:0,behavior:"smooth"}):o.scrollBy({left:u,behavior:"smooth"})},2e3);return()=>clearInterval(h)},[]),e.jsxs("section",{className:"px-4 py-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:s("mainTopRanking")}),e.jsxs("button",{onClick:()=>r("/products/ranking"),className:"text-sm text-gray-800 hover:underline",children:[s("moreButton")," >"]})]}),e.jsx("div",{ref:d,className:"overflow-x-auto no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-2",children:a.map((o, u)=>{var h;return e.jsxs("div",{className:"relative min-w-[160px] flex-shrink-0 bg-white border border-[#eee] rounded-xl shadow-md p-2 cursor-pointer transition hover:shadow-lg",onClick:()=>r(`/products/${o.barcode}`),children:[e.jsx("div",{className:"absolute top-2 left-2 w-6 h-6 flex items-center justify-center rounded-full bg-[#ff5e5e] text-white text-xs font-bold z-10",children:u+1}),e.jsx("div",{className:"w-[140px] h-[140px] mb-3 bg-[#F9F9F9] rounded-md overflow-hidden flex items-center justify-center",children:o.imgThumbUrl?e.jsx("img",{src:`https://myapp.peek-pick.click${o.imgThumbUrl}`,alt:o.name,className:"w-full h-full object-contain"}):e.jsx("div",{className:"text-gray-300 text-sm",children:"No Image"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800 line-clamp-2 mb-1 truncate w-35",children:o.name}),e.jsxs("div",{className:"flex items-center text-xs text-gray-600 space-x-3 mb-1",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(b,{icon:"ri:heart-fill",className:"text-red-500 w-4 h-4 mr-1"}),o.likeCount??0]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(b,{icon:"ri:star-fill",className:"text-yellow-400 w-4 h-4 mr-1"}),((h=o.score)==null?void 0:h.toFixed(1))??"0.0"]})]}),e.jsxs("div",{className:"text-[12px] text-gray-400 mb-1",children:[o.reviewCount??0," reviews"]}),o.category&&e.jsx("div",{className:"text-[11px] text-gray-500 uppercase",children:o.category})]},o.productId)})})})]})}function V(){const{t:s,i18n:n}=g(),t=n.language,r=v(),d=m.useRef(null),i=10,{data:l,isLoading:c,isError:x}=w({queryKey:["productsRecommend",i],queryFn:()=>P(i,void 0,void 0,t),staleTime:1e3*60*5}),f=(l==null?void 0:l.content)??[];return m.useEffect(()=>{const a=d.current;if(!a)return;const o=168*2,u=setInterval(()=>{if(!a)return;const h=a.scrollWidth-a.clientWidth;a.scrollLeft+o>=h?a.scrollTo({left:0,behavior:"smooth"}):a.scrollBy({left:o,behavior:"smooth"})},2e3);return()=>clearInterval(u)},[]),e.jsxs("section",{className:"px-4 py-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:s("mainTopPicksForYou")}),e.jsxs("button",{onClick:()=>r("/products/recommended"),className:"text-sm text-gray-800 hover:underline",children:[s("moreButton")," >"]})]}),e.jsx("div",{ref:d,className:"overflow-x-auto no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsxs("div",{className:"flex gap-2",children:[f.map((a, o)=>{var u;return e.jsxs("div",{className:"min-w-[160px] flex-shrink-0 bg-white border border-[#eee] rounded-xl shadow-md p-2 cursor-pointer transition hover:shadow-lg relative",onClick:()=>r(`/products/${a.barcode}`),children:[e.jsx("div",{className:"absolute top-2 left-2 w-6 h-6 flex items-center justify-center rounded-full bg-[#ff5e5e] text-white text-xs font-bold z-10",children:o+1}),e.jsx("div",{className:"w-[140px] h-[140px] mb-3 bg-[#F9F9F9] rounded-md overflow-hidden flex items-center justify-center",children:a.imgThumbUrl?e.jsx("img",{src:`https://myapp.peek-pick.click${a.imgThumbUrl}`,alt:a.name,className:"w-full h-full object-contain"}):e.jsx("div",{className:"text-gray-300 text-sm",children:"No Image"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-800 line-clamp-2 mb-1 truncate w-35 ",children:a.name}),e.jsxs("div",{className:"flex items-center text-xs text-gray-600 space-x-3 mb-1",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(b,{icon:"ri:heart-fill",className:"text-red-500 w-4 h-4 mr-1"}),a.likeCount??0]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(b,{icon:"ri:star-fill",className:"text-yellow-400 w-4 h-4 mr-1"}),((u=a.score)==null?void 0:u.toFixed(1))??"0.0"]})]}),e.jsxs("div",{className:"text-[12px] text-gray-400 mb-1",children:[a.reviewCount??0," reviews"]}),a.category&&e.jsx("div",{className:"text-[11px] text-gray-500 uppercase",children:a.category})]},a.productId)}),f.length%2!==0&&e.jsx("div",{className:"min-w-[320px] flex-shrink-0 bg-transparent"}),f.length%2==0&&e.jsx("div",{className:"min-w-[320px] flex-shrink-0 bg-transparent"})]})})]})}function p({msg:s}){const{t:n}=g(),t=v(),r=new Array(6).fill(0);return e.jsxs("section",{className:"px-4 py-4 bg-white",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-500 ",children:s})}),e.jsxs("section",{className:"relative px-4 py-4 bg-white",children:[e.jsxs("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center text-center px-4 rounded-xl",style:{backgroundColor:"rgba(180, 180, 180, 0.3)"},children:[e.jsxs("p",{className:"text-gray-700 text-m mb-4",children:["👋 ",n("pleaseLoginToView")]}),e.jsx("button",{onClick:()=>t("/login"),className:"px-4 py-2 bg-amber-300 text-white rounded transition",children:n("goToLogin")})]}),e.jsx("div",{className:"overflow-x-auto no-scrollbar relative z-0",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-2",children:r.map((d, i)=>e.jsxs("div",{className:"min-w-[160px] flex-shrink-0 bg-white border border-[#eee] rounded-xl shadow-md p-2",children:[e.jsx("div",{className:"absolute top-2 left-2 w-6 h-6 rounded-full bg-gray-300 animate-pulse"}),e.jsx("div",{className:"w-[140px] h-[140px] mb-3 bg-gray-200 rounded-md animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2 w-full animate-pulse"}),e.jsxs("div",{className:"flex items-center space-x-3 mb-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-6 h-3 bg-gray-200 rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 rounded-full animate-pulse"}),e.jsx("div",{className:"w-6 h-3 bg-gray-200 rounded animate-pulse"})]})]}),e.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded mb-1 animate-pulse"}),e.jsx("div",{className:"w-12 h-3 bg-gray-200 rounded animate-pulse"})]},i))})})]})]})}const O=()=>e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-white z-60",children:e.jsx("div",{className:"flex w-full items-center bg-white justify-center h-screen",children:e.jsx("img",{src:"/loading/mainLoadidng.gif",alt:"Loading...",className:"w-64 h-64"})})}),N=async s=>await C.post("/push/fcm",{token:s}),$=async s=>{try{return(await C.post("/push/fcm/validate",{token:s})).data.valid===!0}catch(n){return console.error("[FCM] 토큰 유효성 확인 오류:",n),!1}},D="BDAplh41wdfZfcOyO9cF-YP3mwZLGXj84cGK8MuJ9VbGObCOHghhzIINmOof5_nYUqgf1JHPSAYLMjMrv8m_EU0";async function K(){try{const s=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return await navigator.serviceWorker.ready,console.log("[SW] Registered:",s.scope),s}catch(s){return console.error("[SW] 등록 실패:",s),null}}async function y(){const s=R();if(!s)return null;const n=await K();if(!n)return null;try{const t=await A(s,{vapidKey:D,serviceWorkerRegistration:n});if(!t)return null;try{await N(t)}catch{await N(t),console.log("[FCM] 새 토큰 저장 완료:",t)}return t}catch(t){return console.error("[FCM] 토큰 요청 실패:",t),null}}async function U(s){if(Notification.permission!=="denied"){await Notification.requestPermission()==="granted"&&await y();return}else await B.fire({icon:"info",title:s("push.permissionDeniedTitle","알림 권한이 차단되어 있어요."),text:s("push.permissionDeniedText","브라우저 설정에서 알림 권한을 다시 허용해주세요."),confirmButtonText:s("confirm","확인"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}})}function G(){const{t:s}=g(),[n,t]=m.useState(!1),r=()=>t(!0),d=async()=>{t(!1),await U(s)};return m.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n]),{openModal:r,ChangePermissionModal:()=>n?E.createPortal(e.jsx("div",{style:Y,children:e.jsxs("div",{style:H,children:[e.jsxs("h2",{style:{textAlign:"center",marginBottom:12},children:["🔔 ",s("push.manageNotificationSettings","Manage Notification Settings")]}),e.jsx("p",{style:{textAlign:"center",marginBottom:16},children:s("push.alertDescription","Get alerts about new reviews and updates. You can always change this later.")}),e.jsxs("p",{style:{fontSize:"12px",color:"#888",textAlign:"center",marginBottom:16},children:[s("push.settingsPrefix","Settings available under"),e.jsx("br",{}),e.jsx("strong",{children:"My Page > Notifications"}),"."]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{onClick:()=>t(!1),style:J,children:s("cancel","Close")}),e.jsx("button",{onClick:d,className:"bg-emerald-500 text-white px-4 py-2 rounded-lg",children:s("push.update","Update")})]})]})}),document.body):null}}const Y={position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},H={backgroundColor:"#fff",padding:24,borderRadius:12,width:"90%",maxWidth:400,boxShadow:"0 4px 15px rgba(0,0,0,0.3)"},J={backgroundColor:"#bbb",color:"white",border:"none",padding:"8px 16px",borderRadius:8,cursor:"pointer"};function X(){const[s,n]=m.useState(!0),{isLoggedIn:t,isLoading:r}=W(),{openModal:d,ChangePermissionModal:i}=G();return m.useEffect(()=>{if(r)return;if(!t){n(!1);return}if(sessionStorage.getItem("hasVisitedMain"))n(!1);else{sessionStorage.setItem("hasVisitedMain","true"),t&&Notification.permission!=="granted"&&d();const c=setTimeout(()=>n(!1),3e3);return()=>clearTimeout(c)}},[r,t]),m.useEffect(()=>{if(!t)return;const l=localStorage.getItem("fcmToken");if(!l){console.log("[FCM] 저장된 토큰 없음, 새 토큰 생성 시도"),y().then(c=>{c?(localStorage.setItem("fcmToken",c),console.log("[FCM] 새 토큰 발급 및 저장 완료:",c)):console.log("[FCM] 새 토큰 발급 실패")}).catch(c=>{console.error("[FCM] 새 토큰 요청 중 오류:",c)});return}$(l).then(c=>{c?console.log("[FCM] 토큰 유효 확인 완료"):(console.log("[FCM] 토큰이 유효하지 않음, 재발급 시도"),y().then(x=>{x?(localStorage.setItem("fcmToken",x),console.log("[FCM] 재발급된 새 토큰 저장 완료:",x)):console.log("[FCM] 재발급된 토큰 발급 실패")}).catch(x=>{console.error("[FCM] 재발급 요청 중 오류:",x)}))}).catch(c=>{console.error("[FCM] 토큰 유효성 검증 중 오류:",c)})},[t]),s?e.jsx(O,{}):e.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-2xl shadow relative space-y-4",children:[e.jsx(_,{}),e.jsx(z,{}),r?e.jsxs(e.Fragment,{children:[e.jsx(p,{msg:"Top Ranking"}),e.jsx(p,{msg:"Top Picks for you"})]}):t?e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx(V,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{msg:"Top Ranking"}),e.jsx(p,{msg:"Top Picks for you"})]}),e.jsx(i,{}),e.jsx(F,{})]})}const ve=S(X);export{ve as default};
