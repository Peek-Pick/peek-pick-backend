var x=e=>{throw TypeError(e)};var I=(e,t,s)=>t.has(e)||x("Cannot "+s);var o=(e,t,s)=>(I(e,t,"read from private field"),s?s.call(e):t.get(e)),b=(e,t,s)=>t.has(e)?x("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),h=(e,t,s,r)=>(I(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s);var N=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},O=typeof window>"u"||"Deno"in globalThis;function ae(){}function oe(e,t){return typeof e=="function"?e(t):e}function _(e){return typeof e=="number"&&e>=0&&e!==1/0}function ce(e,t){return Math.max(e+(t||0)-Date.now(),0)}function le(e,t){return typeof e=="function"?e(t):e}function fe(e,t){return typeof e=="function"?e(t):e}function he(e,t){const{type:s="all",exact:r,fetchStatus:n,predicate:u,queryKey:y,stale:i}=e;if(y){if(r){if(t.queryHash!==$(y,t.options))return!1}else if(!K(t.queryKey,y))return!1}if(s!=="all"){const c=t.isActive();if(s==="active"&&!c||s==="inactive"&&c)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||n&&n!==t.state.fetchStatus||u&&!u(t))}function ye(e,t){const{exact:s,status:r,predicate:n,mutationKey:u}=e;if(u){if(!t.options.mutationKey)return!1;if(s){if(R(t.options.mutationKey)!==R(u))return!1}else if(!K(t.options.mutationKey,u))return!1}return!(r&&t.state.status!==r||n&&!n(t))}function $(e,t){return((t==null?void 0:t.queryKeyHashFn)||R)(e)}function R(e){return JSON.stringify(e,(t,s)=>k(s)?Object.keys(s).sort().reduce((r,n)=>(r[n]=s[n],r),{}):s)}function K(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(s=>K(e[s],t[s])):!1}function Q(e,t){if(e===t)return e;const s=D(e)&&D(t);if(s||k(e)&&k(t)){const r=s?e:Object.keys(e),n=r.length,u=s?t:Object.keys(t),y=u.length,i=s?[]:{};let c=0;for(let w=0;w<y;w++){const l=s?w:u[w];(!s&&r.includes(l)||s)&&e[l]===void 0&&t[l]===void 0?(i[l]=void 0,c++):(i[l]=Q(e[l],t[l]),i[l]===e[l]&&e[l]!==void 0&&c++)}return n===y&&c===n?e:i}return t}function de(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}function D(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function k(e){if(!U(e))return!1;const t=e.constructor;if(t===void 0)return!0;const s=t.prototype;return!(!U(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function U(e){return Object.prototype.toString.call(e)==="[object Object]"}function W(e){return new Promise(t=>{setTimeout(t,e)})}function be(e,t,s){return typeof s.structuralSharing=="function"?s.structuralSharing(e,t):s.structuralSharing!==!1?Q(e,t):t}function ve(e,t,s=0){const r=[...e,t];return s&&r.length>s?r.slice(1):r}function me(e,t,s=0){const r=[t,...e];return s&&r.length>s?r.slice(0,-1):r}var X=Symbol();function we(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===X?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function pe(e,t){return typeof e=="function"?e(...t):!!e}var p,v,S,z,Y=(z=class extends N{constructor(){super();b(this,p);b(this,v);b(this,S);h(this,S,t=>{if(!O&&window.addEventListener){const s=()=>t();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){o(this,v)||this.setEventListener(o(this,S))}onUnsubscribe(){var t;this.hasListeners()||((t=o(this,v))==null||t.call(this),h(this,v,void 0))}setEventListener(t){var s;h(this,S,t),(s=o(this,v))==null||s.call(this),h(this,v,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){o(this,p)!==t&&(h(this,p,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(s=>{s(t)})}isFocused(){var t;return typeof o(this,p)=="boolean"?o(this,p):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},p=new WeakMap,v=new WeakMap,S=new WeakMap,z),Z=new Y,E,m,F,A,ee=(A=class extends N{constructor(){super();b(this,E,!0);b(this,m);b(this,F);h(this,F,t=>{if(!O&&window.addEventListener){const s=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",r)}}})}onSubscribe(){o(this,m)||this.setEventListener(o(this,F))}onUnsubscribe(){var t;this.hasListeners()||((t=o(this,m))==null||t.call(this),h(this,m,void 0))}setEventListener(t){var s;h(this,F,t),(s=o(this,m))==null||s.call(this),h(this,m,t(this.setOnline.bind(this)))}setOnline(t){o(this,E)!==t&&(h(this,E,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return o(this,E)}},E=new WeakMap,m=new WeakMap,F=new WeakMap,A),g=new ee;function te(){let e,t;const s=new Promise((n,u)=>{e=n,t=u});s.status="pending",s.catch(()=>{});function r(n){Object.assign(s,n),delete s.resolve,delete s.reject}return s.resolve=n=>{r({status:"fulfilled",value:n}),e(n)},s.reject=n=>{r({status:"rejected",reason:n}),t(n)},s}function se(e){return Math.min(1e3*2**e,3e4)}function re(e){return(e??"online")==="online"?g.isOnline():!0}var H=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function je(e){return e instanceof H}function Se(e){let t=!1,s=0,r=!1,n;const u=te(),y=a=>{var f;r||(L(new H(a)),(f=e.abort)==null||f.call(e))},i=()=>{t=!0},c=()=>{t=!1},w=()=>Z.isFocused()&&(e.networkMode==="always"||g.isOnline())&&e.canRun(),l=()=>re(e.networkMode)&&e.canRun(),B=a=>{var f;r||(r=!0,(f=e.onSuccess)==null||f.call(e,a),n==null||n(),u.resolve(a))},L=a=>{var f;r||(r=!0,(f=e.onError)==null||f.call(e,a),n==null||n(),u.reject(a))},q=()=>new Promise(a=>{var f;n=d=>{(r||w())&&a(d)},(f=e.onPause)==null||f.call(e)}).then(()=>{var a;n=void 0,r||(a=e.onContinue)==null||a.call(e)}),P=()=>{if(r)return;let a;const f=s===0?e.initialPromise:void 0;try{a=f??e.fn()}catch(d){a=Promise.reject(d)}Promise.resolve(a).then(B).catch(d=>{var C;if(r)return;const T=e.retry??(O?0:3),M=e.retryDelay??se,V=typeof M=="function"?M(s,d):M,J=T===!0||typeof T=="number"&&s<T||typeof T=="function"&&T(s,d);if(t||!J){L(d);return}s++,(C=e.onFail)==null||C.call(e,s,d),W(V).then(()=>w()?void 0:q()).then(()=>{t?L(d):P()})})};return{promise:u,cancel:y,continue:()=>(n==null||n(),u),cancelRetry:i,continueRetry:c,canStart:l,start:()=>(l()?P():q().then(P),u)}}var ne=e=>setTimeout(e,0);function ie(){let e=[],t=0,s=i=>{i()},r=i=>{i()},n=ne;const u=i=>{t?e.push(i):n(()=>{s(i)})},y=()=>{const i=e;e=[],i.length&&n(()=>{r(()=>{i.forEach(c=>{s(c)})})})};return{batch:i=>{let c;t++;try{c=i()}finally{t--,t||y()}return c},batchCalls:i=>(...c)=>{u(()=>{i(...c)})},schedule:u,setNotifyFunction:i=>{s=i},setBatchNotifyFunction:i=>{r=i},setScheduler:i=>{n=i}}}var Ee=ie(),j,G,Fe=(G=class{constructor(){b(this,j)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),_(this.gcTime)&&h(this,j,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(O?1/0:5*60*1e3))}clearGcTimeout(){o(this,j)&&(clearTimeout(o(this,j)),h(this,j,void 0))}},j=new WeakMap,G);export{Fe as R,N as S,ye as a,ae as b,oe as c,R as d,we as e,Z as f,me as g,$ as h,ve as i,be as j,fe as k,Se as l,he as m,Ee as n,g as o,K as p,je as q,le as r,X as s,ce as t,re as u,te as v,de as w,O as x,_ as y,pe as z};
