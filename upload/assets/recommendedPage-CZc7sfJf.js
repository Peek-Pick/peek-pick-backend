import{w as x}from "./with-props-JNWkkrjn.js";import{p as R,v as h,a as o}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as r}from "./jsx-runtime-D_zvdyIk.js";import{u as E}from "./useInfiniteQuery-BFmOQqc-.js";import{L as I}from "./listComponent-C0Baj83L.js";import{b as T}from "./productsAPI-NkJZ08PW.js";import{B as N,F as S}from "./FloatingActionButtons-3zuONfQ9.js";import{u as j}from "./useTranslation-DnilsLqi.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./QueryClientProvider--V26__jT.js";import"./infiniteQueryBehavior-6_vRSK1h.js";import"./iconify-uWM87A7v.js";import"./productLoading-CtBxAkDp.js";import"./index-Druiat5n.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./createLucideIcon-Cyt6UY_L.js";import"./i18nInstance-CHFDjdcJ.js";const s="recommendedPageScrollY",U=x(function(){const{i18n:u}=j(),f=u.language,c=12,p=R(),n=h(),i=o.useRef(!1),m=o.useRef(!0);o.useLayoutEffect(()=>{var t;return"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual"),m.current&&((((t=performance.getEntriesByType("navigation").at(-1))==null?void 0:t.type)??"")==="reload"&&(window.scrollTo(0,0),sessionStorage.removeItem(s),i.current=!1),m.current=!1),()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto")}},[]),o.useEffect(()=>{n!=="POP"&&(sessionStorage.removeItem(s),i.current=!1)},[n]);const{data:a,fetchNextPage:d,hasNextPage:g,isFetchingNextPage:w,isLoading:y,isError:P}=E({queryKey:["recommended",c],queryFn:async({pageParam:t})=>{const e=t;return await T(c,e==null?void 0:e.lastValue,e==null?void 0:e.lastProductId,f)},getNextPageParam: t=>{const e=t.content.at(-1);if(!(!e||!t.hasNext))return{lastValue:e.score??0,lastProductId:e.productId}},initialPageParam:void 0,staleTime:5*60*1e3}),v= t=>{sessionStorage.setItem(s,JSON.stringify({scrollY:window.scrollY,fromDetail:!0})),p(`/products/${t}`,{state:{fromDetail:!0}})};return o.useEffect(()=>{if(n==="POP"&&a&&!i.current){const t=sessionStorage.getItem(s);if(t){const{scrollY:e,fromDetail:l}=JSON.parse(t);l&&(window.scrollTo(0,e),requestAnimationFrame(()=>window.scrollTo(0,e))),sessionStorage.removeItem(s)}i.current=!0}},[n,a]),r.jsxs(r.Fragment,{children:[r.jsx(I,{products:a?a.pages.flatMap(t=>t.content):[],fetchNextPage:d,hasNextPage:g,isFetchingNextPage:w,isLoading:y,isError:P,onItemClick:v}),r.jsx(N,{}),r.jsx(S,{})]})});export{U as default};
