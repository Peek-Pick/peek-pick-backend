import{a as u}from "./index-xsH4HHeE.js";const g= e=>e.replace(/([-_][a-z])/g, t=>t.toUpperCase().replace("-","").replace("_","")),k= e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function",f= e=>k(e)?Object.entries(e).reduce((t, [n,a])=>(t[g(n)]=f(a),t),{}):Array.isArray(e)?e.map(t=>f(t)):e,l=u.create({baseURL:"https://myapp.peek-pick.click/api/v1",withCredentials:!0});let o=null;const w=[],p= e=>{w.forEach(({resolve:t,reject:n,config:a})=>{e?n(e):t(l(a))}),w.length=0};l.interceptors.response.use(e=>(e.data&&(e.data=f(e.data)),e),async e=>{var a;const t=e.config,n=(a=e.response)==null?void 0:a.status;if(n===401&&!t._retry){t._retry=!0,o||(o=C().then(()=>p(null)).catch(r=>{p(r),typeof window<"u"&&(window.location.href="/admin/login")}).finally(()=>{o=null}));try{return await o,l(t)}catch(r){return Promise.reject(r)}}return n===403&&(console.warn("권한이 없습니다. 관리자 로그인이 필요합니다."),typeof window<"u"&&(window.location.href="/admin/login")),Promise.reject(e)});const i="https://myapp.peek-pick.click/api/v1";async function R(e, t){const n=await fetch(`${i}/auth/login`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({uem:e,upw:t})});if(!n.ok)throw n.status===403?{type:"banned",banUntil:(await n.json()).banUntil}:new Error("로그인 실패")}const U=async()=>{await s.post("/auth/logout",null,{withCredentials:!0})},A=async()=>{if((await u.get(`${i}/auth/refresh`,{withCredentials:!0})).status!==200)throw new Error("Access token refresh failed")},_=async()=>{const e=await s.get(`${i}/auth/check`,{withCredentials:!0});return console.log("res.data: ",e.data),e.data};async function E(e, t){return await fetch(`${i}/admin/auth/login`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({aid:e,apw:t})}).then(n=>{if(!n.ok)throw new Error("로그인 실패")})}const L=async()=>{await l.post("/auth/logout",null,{withCredentials:!0})},C=async()=>{if((await u.get(`${i}/admin/auth/refresh`,{withCredentials:!0})).status!==200)throw new Error("Access token refresh failed")},P= e=>e.replace(/([-_][a-z])/g, t=>t.toUpperCase().replace("-","").replace("_","")),T= e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function",d= e=>T(e)?Object.entries(e).reduce((t, [n,a])=>(t[P(n)]=d(a),t),{}):Array.isArray(e)?e.map(t=>d(t)):e,s=u.create({baseURL:"https://myapp.peek-pick.click/api/v1",withCredentials:!0});let c=null;const y=[],m= e=>{y.forEach(({resolve:t,reject:n,config:a})=>{e?n(e):t(s(a))}),y.length=0};s.interceptors.response.use(e=>(e.data&&(e.data=d(e.data)),e),async e=>{var a;const t=e.config,n=(a=e.response)==null?void 0:a.status;if(n===401&&!t._retry){t._retry=!0,c||(c=A().then(()=>m(null)).catch(r=>{var h;m(r),(h=e.config.meta)!=null&&h.allowAnonymous||typeof window<"u"&&(window.location.href="/login")}).finally(()=>{c=null}));try{return await c,s(t)}catch(r){return Promise.reject(r)}}return n===403&&(console.warn("권한이 없습니다. 관리자 로그인이 필요합니다."),typeof window<"u"&&(window.location.href="/admin/login")),Promise.reject(e)});export{l as a,E as b,_ as c,L as d,R as g,s as i,U as l};
