import{w as P}from "./with-props-JNWkkrjn.js";import{a as l,w as E}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as e}from "./jsx-runtime-D_zvdyIk.js";import{u as S}from "./QueryClientProvider--V26__jT.js";import{u as q}from "./useMutation-iBKtBQ4J.js";import{t as $,a as B,d as I,c as M}from "./reviewAPI-zRekXALF.js";import{u as F}from "./useReviewReport-CWkDotFm.js";import{R as T}from "./rating-s5hnHQfB.js";import{R as H,a as A}from "./reviewLoading-C78wslp8.js";import{u as D,F as K}from "./floatingHearts-Bwxc8ijh.js";import{F as Q,B as O}from "./FloatingActionButtons-3zuONfQ9.js";import"./index-Druiat5n.js";import"./sweetalert2.esm.all-9Qm2jZ7z.js";import{A as U,a as z,T as _,H as W,t as G}from "./averageRatingSection-CBjjqmYw.js";import{I as J}from "./ImageModalComponent-Cw5E8d8F.js";import{u as R}from "./useTranslation-DnilsLqi.js";import{u as C}from "./useQuery-CxabGwVz.js";import{u as V}from "./useInfiniteQuery-BFmOQqc-.js";import{g as X}from "./productsAPI-NkJZ08PW.js";import"./mutation-CruqbX-z.js";import"./removable-CGh8wCEh.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";/* empty css                         */import"./createLucideIcon-Cyt6UY_L.js";import"./proxy-B6a-3iLd.js";import"./i18nInstance-CHFDjdcJ.js";import"./useBaseQuery-BTSvK_Q6.js";import"./query-CjmfnAM3.js";import"./infiniteQueryBehavior-6_vRSK1h.js";function Y({aiReview:t,productData:b,productId:n,reviewList:c,fetchNextPage:r,hasNextPage:f,isFetchingNextPage:d,isLoading:m,isError:u,sortType:o,setSortType:y,productLoading:g,productError:h}){const{t:x}=R(),j=S(),p=l.useRef(null);l.useEffect(()=>{if(!p.current||!f)return;const a=new IntersectionObserver(([w])=>{w.isIntersecting&&!d&&r().then()},{rootMargin:"100px",threshold:1});return a.observe(p.current),()=>a.disconnect()},[r,f,d]);const v= a=>{o!==a&&(j.removeQueries({queryKey:["productReviews",n,o]}),y(a))};return m||g?e.jsx(H,{}):u||h||!c||!b?e.jsx("p",{className:"text-center p-4 text-red-500 text-base sm:text-lg",children:x("reviewLoadError")}):e.jsxs("div",{children:[e.jsx("section",{className:"relative",children:e.jsx("div",{className:"w-full max-w-7xl md:px-5 lg-6 mx-auto",children:e.jsxs("div",{className:"w-full",children:[e.jsx(U,{score:b.score??5,reviewCount:b.reviewCount}),t&&e.jsx(z,{aiReview:t}),e.jsx("div",{className:"flex text-sm sm:text-sm justify-between items-center border-t border-b border-gray-200 py-2 mb-4",children:e.jsxs("nav",{className:"tabs tabs-bordered","aria-label":"Sort Tabs",role:"tablist","aria-orientation":"horizontal",children:[e.jsx("button",{type:"button",className:`tab px-2 py-2 rounded-md hover:font-semibold transition-all duration-200 ${o==="latest"?"tab-active text-indigo-600 font-bold":""}`,onClick:()=>v("latest"),role:"tab","aria-selected":o==="latest",children:x("sortReviewLatest")}),e.jsx("button",{type:"button",className:`tab px-2 py-2 rounded-md hover:font-semibold transition-all duration-200 ${o==="likes"?"tab-active text-indigo-600 font-bold":""}`,onClick:()=>v("likes"),role:"tab","aria-selected":o==="likes",children:x("sortReviewLike")})]})}),c.map(a=>e.jsx(Z,{review:a,productId:n},`${o}-${a.reviewId}`))]})})}),e.jsx(Q,{}),e.jsx(O,{}),f&&e.jsx("div",{ref:p,className:"h-1"}),d&&e.jsx(A,{})]})}function Z({review:t,productId:b}){var N,i;const{t:n}=R(),c=S(),[r,f]=l.useState(!1),{openReportModal:d}=F(t.reviewId),[m,u]=l.useState(!1),[o,y]=l.useState(null),[g,h]=l.useState(!1),[x,j]=l.useState(null),p=q({mutationFn: s=>$(s),onSuccess:()=>{c.invalidateQueries({queryKey:["productReviews",b]}).then()},onError: s=>{console.error("toggleLikeMutation failed: ",s)}}),{handleLikeClick:v,containerRef:a,hearts:w}=D(p.mutate,t),L=async()=>{if(m){u(!1);return}try{h(!0);const s=await G(t.reviewId);y(s.data),u(!0)}catch(s){console.error("번역 실패",s)}finally{h(!1)}};return e.jsxs("div",{className:"relative",ref:a,children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-md mb-2",children:[e.jsx("div",{className:"flex sm:items-center flex-col min-[400px]:flex-row justify-between gap-5 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:`http://myapp.peek-pick.click/users/${t.profileImageUrl}`,alt:"profile image",className:"w-14 h-14 rounded-full object-cover"}),e.jsx("h6",{className:"font-semibold text-md leading-8 text-gray-600",children:t.nickname??"User"})]}),e.jsxs("button",{onClick:L,disabled:g,className:"flex items-center gap-1 text-xs px-3 py-1.5 rounded-full transition-all shadow-sm bg-blue-50 text-blue-500 hover:bg-blue-100",children:[e.jsx("span",{children:m?"↩":"🌐"}),e.jsx("span",{children:n(m?"translateOriginalButton":"translateButton")})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:5}).map((s, k)=>e.jsx(T,{filled:k<t.score},k))}),e.jsx("p",{className:"font-normal text-sm sm:text-sm text-gray-400",children:new Date(t.regDate).toLocaleDateString()})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("p",{className:`text-sm text-gray-700 whitespace-pre-line transition-opacity duration-300 ${g?"opacity-20 blur-[1px]":"opacity-100"}`,children:m?o:t.comment}),g&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:e.jsx(_,{})})]}),((N=t.images)==null?void 0:N.length)>0&&e.jsx("div",{className:"flex flex-nowrap space-x-2 mb-4 overflow-x-auto no-scrollbar",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:t.images.map(s=>e.jsx("img",{src:`https://myapp.peek-pick.click/reviews/s_${s.imgUrl}`,alt:"Review Image",onClick:()=>j(`https://myapp.peek-pick.click/reviews/${s.imgUrl}`),className:"w-25 h-25 sm:w-25 sm:h-25 rounded-lg object-cover flex-shrink-0 border-1 border-gray-300 "},s.imgId))}),x&&e.jsx(J,{src:x,onClose:()=>j(null)}),((i=t.tagList)==null?void 0:i.length)>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:t.tagList.map(s=>e.jsxs("span",{className:"bg-emerald-50 text-emerald-500 border border-emerald-200 text-sm sm:text-sm px-3 py-1 rounded-full",children:["#",n(`tags.${s.tagName}`)]},s.tagId))}),e.jsxs("div",{className:"flex justify-between items-center text-sm sm:text-base mt-3",children:[e.jsxs("button",{onClick:v,disabled:p.isPending,className:`flex items-center gap-1 px-2 py-1 rounded-full border font-medium text-sm sm:text-sm
                        ${t.isLiked?"bg-red-50 text-red-500 border-red-200":"bg-gray-100 text-gray-500 border-gray-200"} 
                        hover:shadow-sm transition-colors duration-200`,children:[t.isLiked?"❤️":"🤍"," ",n("likeReview")," ",t.recommendCnt]}),e.jsx("button",{onClick:d,className:"text-red-500 hover:text-red-600 transition text-sm sm:text-sm duration-200",children:n("reportReview")}),w.map(s=>e.jsx(K,{x:s.x,y:s.y},s.id))]})]}),t.isHidden&&!r&&e.jsx(W,{onReveal:()=>f(!0)})]})}function ee(){const{barcode:t}=E(),{t:b,i18n:n}=R(),c=n.language,[r,f]=l.useState(null),[d,m]=l.useState("latest");l.useEffect(()=>{t&&B(t).then(i=>{f(Number(i.data))})},[t]);const{data:u,fetchNextPage:o,hasNextPage:y,isFetchingNextPage:g,isLoading:h,isError:x}=V({queryKey:["productReviews",r,d],queryFn:({pageParam:i=0})=>d==="latest"?I(r,i,"regDate",c):I(r,i,"recommendCnt",c),initialPageParam:0,enabled:r!==null,getNextPageParam:i=>{const s=i.data.pageable.pageNumber;return i.data.last?void 0:s+1}}),j=(u==null?void 0:u.pages.flatMap(i=>i.data.content))??[],{data:p,isLoading:v,isError:a}=C({queryKey:["productData",t],queryFn:()=>X(t,c)}),{data:w,isLoading:L,isError:N}=C({queryKey:["reviewSummary",r],queryFn:()=>M(r,c),enabled:r!==null});return e.jsx("div",{children:e.jsx(Y,{aiReview:w,productId:Number(r),productData:p,reviewList:j,fetchNextPage:o,hasNextPage:y,isFetchingNextPage:g,isLoading:h,isError:x,sortType:d,setSortType:m,productLoading:v,productError:a})})}const Ee=P(ee);export{Ee as default};
