import{w as I}from "./with-props-JNWkkrjn.js";import{a as d,p as O,w as E}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as e}from "./jsx-runtime-D_zvdyIk.js";import{u as L}from "./useQuery-CxabGwVz.js";import{u as $}from "./useMutation-iBKtBQ4J.js";import{f as D}from "./reviewAPI-zRekXALF.js";import{u as A}from "./useTagSelector-B0AbEUZv.js";import{a as K}from "./rating-s5hnHQfB.js";import{R as F}from "./reviewLoading-C78wslp8.js";import{i as G}from "./react-textarea-autosize.browser.esm-Dj6DKNmx.js";import{S as c}from "./sweetalert2.esm.all-9Qm2jZ7z.js";/* empty css                   */import{B as U}from "./FloatingActionButtons-3zuONfQ9.js";import{u as y}from "./useTranslation-DnilsLqi.js";import{g as q}from "./productsAPI-NkJZ08PW.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./QueryClientProvider--V26__jT.js";import"./mutation-CruqbX-z.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./index-Druiat5n.js";import"./createLucideIcon-Cyt6UY_L.js";import"./i18nInstance-CHFDjdcJ.js";function M({product:o,isLoading:g,isError:p}){const{t:s}=y(),i=d.useRef(null),[m,x]=d.useState(0),[b,f]=d.useState([]),N=O(),[R]=d.useState([]),{selectedTags:h,toggleTag:B,groupedTags:S}=A(R),l=$({mutationFn: t=>(c.fire({title:s("submittingReview"),allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{c.showLoading()},customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then(),D(t)),onSuccess:()=>{c.fire({title:s("submittingReviewSuccess"),icon:"success",confirmButtonText:s("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then(()=>{N("/reviews/user",{replace:!0})})},onError:()=>{c.fire({title:s("submittingReviewFail"),icon:"error",confirmButtonText:s("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then()}}),C= t=>{const r=t.target.files;if(!r)return;const a=Array.from(r);f(n=>[...n,...a])},k= t=>f(r=>r.filter((a, n)=>n!==t)),T= t=>{var u,w,j,v;if(t.preventDefault(),!((w=(u=i.current)==null?void 0:u.comment.value)==null?void 0:w.trim())){c.fire({title:s("submittingReviewCheck"),icon:"warning",confirmButtonText:s("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}).then();return}const a={productId:o.productId,score:Number((j=i.current)==null?void 0:j.score.value),comment:(v=i.current)==null?void 0:v.comment.value,tagIdList:h},n=new FormData;n.append("review",new Blob([JSON.stringify(a)],{type:"application/json"})),b.forEach(P=>{n.append("files",P)}),l.mutate(n)};return g?e.jsx(F,{}):p||!o?e.jsx("p",{className:"text-center p-4 text-red-500 text-base sm:text-lg",children:s("productLoadError")}):e.jsx("section",{className:"py-12",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("img",{src:`https://myapp.peek-pick.click${(o==null?void 0:o.imgUrl)||"/example.jpg"}`,alt:(o==null?void 0:o.name)||"Product Image",className:"w-40 h-40 sm:w-40 sm:h-40 md:w-40 md:h-40 rounded-lg object-cover mb-"}),e.jsx("p",{className:"text-base sm:text-base md:text-md font-semibold text-gray-800 text-center",children:o==null?void 0:o.name})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h3",{className:"font-manrope font-bold text-lg sm:text-xl text-gray-700 mb-4",children:s("reviewAddGuide")}),e.jsx("div",{className:"flex justify-center space-x-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{onClick:()=>x(t),className:"transform transition hover:scale-110 focus:outline-none","aria-label":`${t}점`,children:e.jsx(K,{filled:t<=m})},t))})]}),m>0&&e.jsxs("form",{ref:i,onSubmit:T,encType:"multipart/form-data",className:"space-y-6",children:[e.jsx("input",{type:"hidden",name:"score",value:m}),e.jsx(G,{name:"comment",minRows:6,maxRows:15,placeholder:s("reviewCommentGuide"),className:"w-full border text-gray-600 border-gray-300 rounded-md p-3 text-sm sm:text-sm focus:outline-none focus:ring-2 focus:ring-gray-300"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800 mb-2 text-base sm:text-base",children:s("tagSelectGuide")}),e.jsx("div",{className:"space-y-4",children:Object.entries(S).map(([t,r])=>e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-sm sm:text-base font-semibold text-gray-600 mb-2",children:s(`categories.${t}`)}),e.jsx("div",{className:"flex overflow-x-auto no-scrollbar space-x-2 px-1 pb-1 -mx-1",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:r.map(a=>e.jsx("button",{type:"button",onClick:()=>B(a.tagId),className:`whitespace-nowrap px-3 py-1 text-sm sm:text-sm rounded-full border transition-colors
                                                        ${h.includes(a.tagId)?"bg-emerald-50 text-emerald-500 border-emerald-200":"bg-gray-100 text-gray-500 border-gray-400"}`,children:s(`tags.${a.tagName}`)},a.tagId))})]},t))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base sm:text-base text-gray-800 mb-2",children:s("addPhotoGuide")}),e.jsxs("div",{className:"w-full overflow-x-auto no-scrollbar flex space-x-2",children:[e.jsxs("label",{className:"w-25 h-25 sm:w-25 sm:h-25 flex-shrink-0 flex items-center justify-center border-2 border-dashed rounded-md text-gray-400 cursor-pointer",children:[e.jsx("span",{className:"text-2xl",children:"＋"}),e.jsx("input",{type:"file",name:"files",multiple:!0,accept:"image/*",onChange:t=>{C(t)},className:"hidden"})]}),b.map((t,r)=>e.jsxs("div",{className:"relative w-25 h-25 sm:w-25 sm:h-25 flex-shrink-0 rounded-lg overflow-hidden border border-gray-300",children:[e.jsx("img",{src:URL.createObjectURL(t),alt:`preview-${r}`,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>{k(r),f(a=>a.filter((n,u)=>u!==r))},className:"absolute top-1 right-1 bg-black/50 text-white text-xs rounded-lg w-5 h-5 flex items-center justify-center",children:"×"})]},r))]})]}),e.jsx("button",{type:"submit",disabled:l.isPending,className:`
                                w-full px-4 py-2 font-medium rounded-md text-sm sm:text-sm transition-colors
                                ${l.isPending?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-emerald-400 text-white hover:bg-emerald-600"}
                            `,children:l.isPending?s("submittingReviewButtonPending"):s("submittingReviewButton")})]}),e.jsx(U,{})]})})}function V(){const{barcode:o}=E(),{t:g,i18n:p}=y(),s=p.language,{data:i,isLoading:m,isError:x}=L({queryKey:["productDetail",o],queryFn:()=>q(o,s)});return e.jsx("div",{children:e.jsx(M,{product:i,isLoading:m,isError:x})})}const ge=I(V);export{ge as default};
