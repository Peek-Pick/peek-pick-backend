import{w as E}from "./with-props-JNWkkrjn.js";import{a as m}from "./chunk-D4RADZKF-DdSvw7tX.js";import{j as e}from "./jsx-runtime-D_zvdyIk.js";import{p as S}from "./index-DJdx2QAc.js";import{u as T}from "./useTagSelector-B0AbEUZv.js";import{u as F}from "./usePasswordChange-C7rN1fas.js";import{u as v}from "./useTranslation-DnilsLqi.js";import{u as B}from "./useNicknameChecker-BYXU2R2N.js";/* empty css                   */import{S as P}from "./sweetalert2.esm.all-9Qm2jZ7z.js";import{u as U,a as L}from "./myPageAPI-BH0myYQf.js";import{u as O}from "./QueryClientProvider--V26__jT.js";import{g as $}from "./countryUtils-CZtoRm9G.js";import{u as A}from "./useQuery-CxabGwVz.js";import{B as M,F as q}from "./FloatingActionButtons-3zuONfQ9.js";import{U as D,E as K}from "./errorComponent-BZQ7Dmt3.js";import"./iconBase-CtWej6xm.js";import"./axiosInstance-CCaw23o5.js";import"./index-xsH4HHeE.js";import"./i18nInstance-CHFDjdcJ.js";import"./signupAPI-CKOHqB1c.js";import"./useBaseQuery-BTSvK_Q6.js";import"./removable-CGh8wCEh.js";import"./query-CjmfnAM3.js";import"./createLucideIcon-Cyt6UY_L.js";import"./index-Druiat5n.js";function R(s){const[t,r]=m.useState(null),[c,l]=m.useState(s),u= o=>{var x;const i=(x=o.target.files)==null?void 0:x[0];if(i){r(i);const p=URL.createObjectURL(i);l(p)}};return m.useEffect(()=>{l(s)},[s]),{file:t,previewUrl:c,handleFileChange:u}}function I({isSocial:s,currentPassword:t,newPassword:r,confirmPassword:c,checkStatus:l,setCurrentPassword:u,setNewPassword:o,setConfirmPassword:i,error:x,checkCurrentPassword:p}){const{t:a}=v();return s?e.jsx("p",{className:"text-sm text-gray-500",children:a("form.ifSocial")}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:a("form.currentPassword")}),e.jsx("input",{type:"password",placeholder:a("form.enterCurrentPassword"),className:"w-full border rounded px-4 py-2",value:t,onChange: d=>u(d.target.value)}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:p,className:"text-sm text-emerald-600 hover:underline",children:[a("form.passwordCheck")," >"]}),l==="success"&&e.jsxs("p",{className:"text-sm text-emerald-600",children:[" ",a("form.passwordCheckSuccess")]}),l==="fail"&&x&&e.jsx("p",{className:"text-sm text-red-500",children:x})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:a("form.newPassword")}),e.jsx("input",{type:"password",placeholder:a("form.enterNewPassword"),className:"w-full border rounded px-4 py-2",value:r,onChange: d=>o(d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:a("form.checkPassword")}),e.jsx("input",{type:"password",placeholder:a("form.enterNewPasswordRe"),className:"w-full border rounded px-4 py-2",value:c,onChange: d=>i(d.target.value)})]})]})}const Q=()=>{const{t:s}=v(),[t,r]=m.useState(!1),[c,l]=m.useState(null),[u,o]=m.useState(!1),i=O();return{handleSubmit:async(p, a, d, h)=>{var b,y;const f=new FormData;f.append("data",new Blob([JSON.stringify({password:p,nickname:a,tagIdList:d})],{type:"application/json"})),h&&f.append("file",h);try{r(!0),l(null),o(!1),await U(f),await Promise.all([i.invalidateQueries({queryKey:["myPageEdit"]})]),o(!0),await P.fire({title:s("updatingProfileSuccess"),icon:"success",confirmButtonText:s("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}}),window.location.reload()}catch(w){l(((y=(b=w.response)==null?void 0:b.data)==null?void 0:y.message)||"Failed to update profile."),P.fire({title:s("updatingProfileFail"),icon:"warning",confirmButtonText:s("confirmOKButtonText"),customClass:{popup:"custom-popup",title:"custom-title",actions:"custom-actions",confirmButton:"custom-confirm-button"}})}finally{r(!1)}},loading:t,error:c,success:u}};function G({profile:s}){const{t}=v(),{selectedTags:r,toggleTag:c,groupedTags:l}=T(s.tagIdList),u=F(),[o,i]=m.useState(""),{isChecking:x,isAvailable:p,error:a}=B(o),{handleSubmit:d}=Q(),[h,f]=m.useState(!1),[b,y]=m.useState(!1),w=s.isSocial,{file:C,handleFileChange:k,previewUrl:N}=R(`/${s.profileImgUrl}`);return e.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-2xl shadow relative space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-200 to-green-300 h-40 rounded-xl"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative inline-block -mt-16",children:[e.jsx("img",{src:N.startsWith("blob:")?N:`https://myapp.peek-pick.click/users/${N}`,alt:"Profile",className:"w-28 h-28 rounded-full border-4 border-white bg-white"}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-emerald-400 text-white p-2 rounded-full cursor-pointer",children:[e.jsx(S,{}),e.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"hidden"})]})]}),e.jsx("h3",{className:"mt-4 mb-1 text-xl font-semibold",children:s.nickname}),e.jsx("p",{className:"text-gray-500 mb-3",children:s.email})]}),e.jsxs("div",{className:"px-4 space-y-6 mt-6",children:[e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold bg-emerald-400 px-3 py-2 text-white",children:t("myPageEdit.account")}),e.jsxs("div",{className:"p-6 bg-white space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:t("form.email")}),e.jsx("input",{type:"email",value:s.email,disabled:!0,className:"w-full bg-gray-50 border rounded px-4 py-2 cursor-not-allowed"})]}),b?e.jsx(I,{...u,isSocial:w}):e.jsxs("button",{onClick:()=>y(!0),className:"text-sm text-emerald-600 hover:underline",children:[t("myPageEdit.changePassword")," >"]})]})]}),e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold bg-emerald-400 px-3 py-2 text-white",children:t("myPageEdit.profileInfo")}),e.jsxs("div",{className:"p-6 bg-white space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:t("form.nickname")}),e.jsx("input",{type:"text",defaultValue:o||s.nickname,className:"w-full border rounded px-4 py-2",onChange: n=>i(n.target.value)}),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:o!==s.nickname&&e.jsxs(e.Fragment,{children:[x&&e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:t("form.checking")}),a&&e.jsx("p",{className:"text-red-500 text-sm mt-1 ml-1",children:a}),p&&!a&&e.jsx("p",{className:"text-green-500 text-sm mt-1 ml-1",children:t("form.nicknameAvailable")})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:t("form.gender")}),e.jsx("input",{type:"text",value:s.gender,disabled:!0,className:"w-full bg-gray-100 border rounded px-4 py-2 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:t("form.nationality")}),e.jsx("input",{type:"text",value:$(s.nationality),disabled:!0,className:"w-full bg-gray-100 border rounded px-4 py-2 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:t("form.birthDate")}),e.jsx("input",{type:"date",value:s.birthDate,disabled:!0,className:"w-full bg-gray-100 border rounded px-4 py-2 cursor-not-allowed"})]})]})]}),e.jsxs("div",{className:"rounded-xl shadow-sm overflow-hidden mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold bg-emerald-400 px-3 py-2 text-white",children:t("myPageEdit.tags")}),e.jsxs("div",{className:"p-6 bg-white",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2 text-sm sm:text-base",children:t("myPageEdit.selectedTags")}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:r.length>0?r.map(n=>{const j=Object.values(l).flat().find(g=>g.tagId===n);return j?e.jsxs("button",{onClick:()=>c(n),className:"px-3 py-1 rounded-full text-sm bg-emerald-100 text-emerald-700 border border-emerald-300",children:[t(`tags.${j.tagName}`)," Ã—"]},n):null}):e.jsx("p",{className:"text-sm text-gray-500",children:t("myPageEdit.noTags")})}),e.jsx("button",{onClick:()=>f(n=>!n),className:"text-sm text-emerald-600 hover:underline mb-4 mt-4",children:t(h?"myPageEdit.hideTags":"myPageEdit.addTags")}),h&&e.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto border-t pt-4",children:Object.entries(l).map(([n,j])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:t(`categories.${n}`)}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(g=>e.jsx("button",{onClick:()=>c(g.tagId),className:`px-3 py-1 rounded-full text-sm border transition-colors ${r.includes(g.tagId)?"bg-gray-200 text-gray-700 border-gray-400":"bg-white text-gray-600 border-gray-300"}`,children:t(`tags.${g.tagName}`)},g.tagId))})]},n))})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:()=>d(u.newPassword,o||s.nickname,r,C),className:"w-full bg-emerald-400 text-white py-2 rounded-lg hover:bg-emerald-500",children:t("form.save")})})]})]})}function J(){return A({queryKey:["myPageEdit"],queryFn:L,retry:1})}function V(){const{data:s,isLoading:t,isError:r}=J();return t?e.jsx(D,{}):r||!s?e.jsx(K,{}):e.jsxs("div",{children:[e.jsx(G,{profile:s}),e.jsx(M,{}),e.jsx(q,{})]})}const ye=E(V);export{ye as default};
